var fm=fm||{};fm.config=function(){"use strict";return{moduleName:"freelancemanager",moduleDependencies:["LocalStorageModule","ngAnimate","ui.bootstrap","ui.router","ui.utils","oc.lazyLoad","ngResource","ft","ngTable","localytics.directives","angular-loading-bar"]}}();var fm=fm||{};fm.module=function(){"use strict";function a(a){var b=angular.module(a,[]);return angular.module(fm.config.moduleName).requires.push(a),b}return{register:a}}(),function(){"use strict";angular.module(fm.config.moduleName,fm.config.moduleDependencies),angular.module(fm.config.moduleName).config(["$locationProvider",function(a){a.hashPrefix("!")}]),angular.element(document).ready(function(){angular.bootstrap(document,[fm.config.moduleName])})}();var fm=fm||{};fm.vendor=function(){"use strict";function a(a){a.config({modules:c})}function b(){var a=arguments;return{vendor:["$ocLazyLoad","$q",function(b,c){function d(a){return"function"==typeof a?e.then(a):e.then(function(){return b.load(a)})}for(var e=c.when(1),f=0,g=a.length;g>f;f++)e=d(a[f]);return e}]}}var c=[{name:"flot",files:["lib/flot/jquery.flot.js"]},{name:"flot-plugins",files:["lib/flot/jquery.flot.resize.js","lib/flot/jquery.flot.pie.js","lib/flot/jquery.flot.time.js","lib/flot/jquery.flot.categories.js","lib/flot/jquery.flot.stack.js","lib/flot-spline/js/jquery.flot.spline.js","lib/flot.tooltip/js/jquery.flot.tooltip.js","lib/angular-flot/angular-flot.js"]},{name:"xlsx",files:["lib/js-xlsx/dist/xlsx.core.min.js"]}];return a.$inject=["$ocLazyLoadProvider"],angular.module(fm.config.moduleName).config(a),{resolve:b}}(),function(){"use strict";fm.module.register("fmAccount")}(),function(){"use strict";fm.module.register("fmCore")}(),function(){"use strict";fm.module.register("fmCrm")}(),function(){"use strict";fm.module.register("fmInvoice")}(),function(){"use strict";fm.module.register("fmProject")}(),function(){"use strict";fm.module.register("fmSettings")}(),function(){"use strict";fm.module.register("fmTime")}(),function(){"use strict";function a(a,b,c){return{request:function(a){return a.headers=a.headers||{},c.localStorage.token&&(a.headers.Authorization="Bearer "+c.localStorage.token),a},response:function(a){return a||b.when(a)}}}function b(a){a.interceptors.push("fmAccountAuthInterceptor")}function c(a,b,c,d,e){a.$on("$stateChangeStart",function(a,f,g){var h=c.localStorage.token&&!e.isTokenExpired(c.localStorage.token);(!f.access||f.access.requiredLogin)&&(h||(a.preventDefault(),b.go("login",{r:d.url()})))})}a.$inject=["$rootScope","$q","$window"],b.$inject=["$httpProvider"],c.$inject=["$rootScope","$state","$window","$location","jwtHelper"],angular.module("fmAccount",["angular-jwt"]),angular.module("fmAccount").factory("fmAccountAuthInterceptor",a),angular.module("fmAccount").config(b),angular.module("fmAccount").run(c)}(),function(){"use strict";function a(a){a.state("login",{url:"/login?r",templateUrl:"modules/account/views/login.html",access:{requiredLogin:!1}}).state("app.account",{url:"/account",templateUrl:"modules/account/views/account.html",access:{requiredLogin:!0}})}a.$inject=["$stateProvider"],angular.module("fmAccount").config(a)}(),function(){"use strict";function a(a,b,c,d){var e=c.decodeToken(b.localStorage.token);a.account=d.get({id:e.id}),a.save=function(){a.isSaving=!0,d.save(e.id,a.account,function(){a.isSaving=!1},function(b){a.isSaving=!1})}}a.$inject=["$scope","$window","jwtHelper","Account"],angular.module("fmAccount").controller("AccountInfoController",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g){delete d.localStorage.token,delete d.localStorage.user,b.user={email:"",password:""},b.error="",b.submit=function(){c.post("/security/authenticate",b.user).success(function(a,b,c,h){var i=g.decodeToken(a.token);d.localStorage.user=i.fullName,d.localStorage.token=a.token,f.path(e.r?decodeURIComponent(e.r):"/").search({})}).error(function(a,c,e,f){delete d.localStorage.token,delete d.localStorage.user,b.error="Invalid email or password",b.user.password=""})}}a.$inject=["$rootScope","$scope","$http","$window","$stateParams","$location","jwtHelper"],angular.module("fmAccount").controller("AccountLoginController",a)}(),function(){"use strict";function a(a,b,c,d){var e=c.decodeToken(b.localStorage.token);a.password={old:"","new":"",confirm:""},a.save=function(){a.isSaving=!0,a.hasError=!1,d.changePassword({id:e.id},{oldPassword:a.password.old,newPassword:a.password["new"]},function(){a.isSaving=!1,a.password.old="",a.password["new"]="",a.password.confirm="",a.accountPasswordForm.$setPristine()},function(b){a.isSaving=!1,a.hasError=!0})}}a.$inject=["$scope","$window","jwtHelper","Account"],angular.module("fmAccount").controller("AccountPasswordController",a)}(),function(){"use strict";function a(a,b,c,d){a.$state=b,a.$stateParams=c,a.$storage=d.localStorage,a.app={name:"Freelance Manager",description:"A demo application in NodeJS",author:"Kevin Cornelis",year:(new Date).getFullYear()}}function b(a){a.parentSelector="#content",a.includeSpinner=!1,a.includeBar=!0,a.latencyThreshold=500}a.$inject=["$rootScope","$state","$stateParams","$window"],b.$inject=["cfpLoadingBarProvider"],angular.module("fmCore").run(a),angular.module("fmCore").config(b)}(),function(){"use strict";angular.module("fmCore").constant("const_mediaquery",{desktopLG:1200,desktop:992,tablet:768,mobile:480})}(),function(){"use strict";function a(a,b){a.state("app",{url:"/app","abstract":!0,templateUrl:"modules/core/views/app.html",controller:"AppController"}).state("app.dashboard",{url:"/dashboard",title:"Dashboard",templateUrl:"modules/core/views/dashboard.html"}),b.otherwise(function(a,b){var c=a.get("$state");c.go("app.dashboard")})}a.$inject=["$stateProvider","$urlRouterProvider"],angular.module("fmCore").config(a)}(),function(){"use strict";function a(a,b,c,d){a.pageTitle=function(){return a.app.name+" - "+a.app.description},a.$on("$stateChangeStart",function(){$("#content").length&&d.start()}),a.$on("$stateChangeSuccess",function(a){a.targetScope.$watch("$viewContentLoaded",function(){d.complete()})})}a.$inject=["$rootScope","$scope","$state","cfpLoadingBar"],angular.module("fmCore").controller("AppController",a)}(),function(){"use strict";function a(){return{link:function(a,b,c){a.$watch(c.fmAddErrorFor,function(d){a.$watch(c.fmAddErrorFor+".$invalid",function(){d.$touched&&d.$invalid&&!d.$pristine?b.addClass("has-error"):b.removeClass("has-error")}),a.$watch(c.fmAddErrorFor+".$touched",function(){d.$touched&&d.$invalid&&!d.$pristine?b.addClass("has-error"):b.removeClass("has-error")})})}}}a.$inject=[],angular.module("fmCore").directive("fmAddErrorFor",a)}(),function(){"use strict";function a(a,b){return{link:function(c,d,e){e.autofocusCondition?c.$watch(function(){return b(e.autofocusCondition)()},function(b){b&&a(function(){d[0].focus()},100)}):a(function(){d[0].focus()},100)}}}a.$inject=["$timeout","$parse"],angular.module("fmCore").directive("autofocus",a)}(),function(){"use strict";function a(){return{restrict:"A",link:function(a,b,c){b.clockpicker({donetext:"DONE",autoclose:!0})}}}a.$inject=[],angular.module("fmCore").directive("fmClockpicker",a)}(),function(){"use strict";function a(a){return{restrict:"A",require:"?ngModel",scope:{fmDatepickerDatechanged:"&"},link:function(a,b,c,d,e){var f=c.fmDatepickerHPosition||"right";b.datepicker({format:c.fmDatepickerFormat||"yyyy-mm-dd",autoclose:!0,orientation:"auto "+f,todayBtn:"linked"}).on("changeDate",function(b){var d=b.format(c.fmDatepickerFormat||"yyyy-mm-dd");a.fmDatepickerDatechanged&&a.$apply(function(){a.fmDatepickerDatechanged({date:d})})})}}}a.$inject=["$timeout"],angular.module("fmCore").directive("fmDatepicker",a)}(),function(){"use strict";function a(a){return{restrict:"A",replace:!0,link:function(b,c,d){b.$watch(d.fmDynamic,function(e){c.html("<div data-fm-with='"+d.fmDynamicBind+"'>"+e+"</div>"),a(c.contents())(b)})}}}a.$inject=["$compile"],angular.module("fmCore").directive("fmDynamic",a)}(),function(){"use strict";function a(){return{restrict:"A",compile:function(a,b){return function(a,c){(b.ngClick||""===b.href||"#"===b.href)&&(c.hasClass("dropdown-toggle")||c.on("click",function(a){a.preventDefault(),a.stopPropagation()}))}}}}a.$inject=[],angular.module("fmCore").directive("href",a)}(),function(){"use strict";function a(a){return{restrict:"A",link:function(b,c,d){b.$watch(d.fmIframe,function(e){var f=a(angular.element("<div data-fm-with='"+d.fmIframeBind+"'>"+e+"</div>"))(b);$(c[0].contentDocument.body).html(f)})}}}a.$inject=["$compile"],angular.module("fmCore").directive("fmIframe",a)}(),function(){"use strict";function a(a){return{require:"?ngModel",restrict:"A",link:function(b,c,d,e){function f(){var a=g(b);return angular.isObject(a)&&a.hasOwnProperty("$viewValue")&&(a=a.$viewValue),a}if(!e)return void(console&&console.warn&&console.warn("Match validation requires ngModel to be on the element"));var g=a(d.fmMatch);b.$watch(f,function(){e.$validate()}),e.$validators.match=function(){return e.$viewValue===f()}}}}a.$inject=["$parse"],angular.module("fmCore").directive("fmMatch",a)}(),function(){"use strict";function a(){return{restrict:"E",link:function(a,b,c){var d=null,e={series:{pie:{show:!0,radius:1,label:{show:!0,radius:2/3,formatter:function(a,b){return'<div style="font-size:8pt; text-align:center; padding:2px; color:white;">'+a+"<br/>"+Math.round(b.percent)+"%</div>"},threshold:.1}}},legend:{show:!1}};a.$watch(c.ngModel,function(a){d?(d.setData(a),d.setupGrid(),d.draw()):a&&(d=$.plot(b,a,e),b.show())})}}}a.$inject=[],angular.module("fmCore").directive("piechart",a)}(),function(){"use strict";function a(){function a(a,b,c){a.$parent.$watch(b.fmWith,function(d,e){var f=a.$parent[b.fmWith];!function(b){for(var d in b)b.hasOwnProperty(d)&&Object.defineProperty(a,d,{enumerable:!0,configurable:!0,get:c(d).bind(a,b,a.$parent),set:c(d).assign.bind(a,b,a.$parent)})}(f)})}return a.$inject=["$scope","$attrs","$parse"],{restrict:"A",scope:!0,controller:a}}a.$inject=[],angular.module("fmCore").directive("fmWith",a)}(),function(){"use strict";function a(a){return a("/api/public/accounts/:id",{id:"@id"},{changePassword:{method:"POST",url:"/api/public/accounts/:id/changepassword",params:{id:"@id"}}})}a.$inject=["$resource"],angular.module("fmCore").factory("Account",a)}(),function(){"use strict";function a(a){return a("/api/public/companies/:id",{id:"@id"})}a.$inject=["$resource"],angular.module("fmCore").factory("Company",a)}(),function(){"use strict";function a(a){return a("/api/public/invoices/:id",{id:"@id"},{preview:{method:"POST",url:"/api/public/invoices/preview",isArray:!1},bydate:{method:"GET",url:"/api/public/invoices/bydate/:from/:to",params:{from:"@from",to:"@to"},isArray:!0},getinfoforperiodpercustomer:{method:"GET",url:"/api/public/invoices/getinfoforperiodpercustomer/:from/:to",params:{from:"@from",to:"@to"},isArray:!0}})}a.$inject=["$resource"],angular.module("fmCore").factory("Invoice",a)}(),function(){"use strict";function a(a){return a("/api/public/projects/:id",{id:"@id"},{active:{method:"GET",url:"/api/public/projects/active",isArray:!0},hide:{method:"POST",url:"/api/public/projects/:id/hide",isArray:!1},unhide:{method:"POST",url:"/api/public/projects/:id/unhide",isArray:!1},changetasks:{method:"POST",url:"/api/public/projects/:id/changetasks",isArray:!1}})}a.$inject=["$resource"],angular.module("fmCore").factory("Project",a)}(),function(){"use strict";function a(a){return a("/api/public/templates/:id",{id:"@id"},{active:{method:"GET",url:"/api/public/templates/active",isArray:!0},hide:{method:"POST",url:"/api/public/templates/:id/hide",isArray:!1},unhide:{method:"POST",url:"/api/public/templates/:id/unhide",isArray:!1}})}a.$inject=["$resource"],angular.module("fmCore").factory("Template",a)}(),function(){"use strict";function a(a){return a("/api/public/timeregistrations/:id",{id:"@id"},{search:{method:"GET",url:"/api/public/timeregistrations/search",isArray:!0},bydate:{method:"GET",url:"/api/public/timeregistrations/bydate/:date",params:{date:"@date"},isArray:!0},byrange:{method:"GET",url:"/api/public/timeregistrations/byrange/:from/:to",params:{from:"@from",to:"@to"},isArray:!0},uninvoiced:{method:"GET",url:"/api/public/timeregistrations/uninvoiced",isArray:!0},getinfoforperiod:{method:"GET",url:"/api/public/timeregistrations/getinfoforperiod/:from/:to",params:{from:"@from",to:"@to"}},getinfoforperiodpertask:{method:"GET",url:"/api/public/timeregistrations/getinfoforperiodpertask/:from/:to",params:{from:"@from",to:"@to"},isArray:!0},saveMultiple:{method:"POST",url:"/api/public/timeregistrations/multiple",isArray:!0}})}a.$inject=["$resource"],angular.module("fmCore").factory("TimeRegistration",a)}(),function(){"use strict";function a(a,b){function c(a){var b={};return _.forEachRight(a.SheetNames,function(c){var e=a.Sheets[c];b[c]=d(e)}),b}function d(a){var b=XLSX.utils.decode_range(a["!ref"]),c=[],d=[];return _.forEachRight(_.range(b.s.r,b.e.r+1),function(e){var f=[];_.forEachRight(_.range(b.s.c,b.e.c+1),function(b){var c=XLSX.utils.encode_cell({c:b,r:e}),d=a[c];f[b]=d?d.v:void 0}),0===e?d=f:c[e-1]=f}),{header:d,data:c,name:a.name,col_size:b.e.c+1,row_size:b.e.r}}var e=function(a){angular.extend(this,a)};return e.readFile=function(b){var d=a.defer(),e=new FileReader;return e.onload=function(a){var b=a.target.result,e=XLSX.read(b,{type:"binary"});d.resolve(c(e))},e.readAsBinaryString(b),d.promise},e}a.$inject=["$q","$rootScope"],angular.module("fmCore").factory("XLSXReader",a)}(),function(){"use strict";function a(){return function(a){return _.has(a,"year")&&_.has(a,"month")&&_.has(a,"day")?a.year+"-"+("00"+a.month).slice(-2)+"-"+("00"+a.day).slice(-2):"-"}}a.$inject=[],angular.module("fmCore").filter("formatdate",a)}(),function(){"use strict";function a(){return function(a){if(_.has(a,"hour")&&_.has(a,"minutes"))return("00"+a.hour).slice(-2)+":"+("00"+a.minutes).slice(-2);if(_.isNumber(a)){var b=Math.floor(a/60),c=Math.floor(a-60*b);return b>99?b+":"+("00"+c).slice(-2):("00"+b).slice(-2)+":"+("00"+c).slice(-2)}return"-"}}a.$inject=[],angular.module("fmCore").filter("formattime",a)}(),function(){"use strict";function a(){return function(a,b){return a.format(b)}}a.$inject=[],angular.module("fmCore").filter("moment",a)}(),function(){"use strict";function a(a){a.state("app.companies",{url:"/crm/companies",templateUrl:"modules/crm/views/companies.html",controller:"CompaniesController"})}a.$inject=["$stateProvider"],angular.module("fmCrm").config(a)}(),function(){"use strict";function a(a,b,c){a.getAllCompanies=function(){c.query(function(b){a.companies=_.sortBy(b,"name")})},a.openCompany=function(c){var d=b.open({templateUrl:"/modules/crm/views/editcompany.html",controller:"CompanyDialogController",resolve:{toUpdate:function(){return c}}});d.result.then(function(b){var c=_.find(a.companies,{id:b.id});c?angular.copy(b,c):a.companies.push(b)})}}a.$inject=["$scope","$modal","Company"],angular.module("fmCrm").controller("CompaniesController",a)}(),function(){"use strict";function a(a,b,c){function d(b){a.isBusy=!0,a.message=b}function e(){a.isBusy=!1,a.message=""}a.originalCompany=c,a.newCompany=void 0===c,c=c||{},a.company={name:c.name,number:c.number,vatNumber:c.vatNumber,address:c.address?{line1:c.address.line1,line2:c.address.line2,postalcode:c.address.postalcode,city:c.address.city}:null},a.isBusy=!1,a.message="",a.ok=function(){d("Saving company...");var c=a.newCompany?{}:{id:a.originalCompany.id};b.save(c,a.company,function(b){e(),a.$close(b)},function(a){d("An error occurred...")})},a.cancel=function(){a.$dismiss("cancel")}}a.$inject=["$scope","Company","toUpdate"],angular.module("fmCrm").controller("CompanyDialogController",a)}(),function(){"use strict";function a(a,b){a.companies=b.query(),a.company={},a.ok=function(){a.$close(_.find(a.companies,function(b){return b.id===a.company.id}))},a.cancel=function(){a.$dismiss("cancel")}}a.$inject=["$scope","Company"],angular.module("fmCrm").controller("SearchCompanyDialogController",a)}(),function(){"use strict";function a(a){a.state("app.invoice_create",{url:"/invoice/create",templateUrl:"modules/invoice/views/create.html",controller:"CreateInvoiceController"}).state("app.invoice_overview",{url:"/invoice/overview/:from/:to",templateUrl:"modules/invoice/views/overview.html",controller:"InvoiceOverviewController",params:{from:function(){return moment().startOf("year").format("YYYYMMDD")},to:function(){return moment().endOf("year").format("YYYYMMDD")}}}).state("app.invoice_report",{url:"/invoice/report/:from/:to",templateUrl:"modules/invoice/views/report.html",controller:"InvoiceReportController",resolve:fm.vendor.resolve("flot","flot-plugins"),params:{from:function(){return moment().startOf("year").format("YYYYMMDD")},to:function(){return moment().endOf("year").format("YYYYMMDD")}}})}a.$inject=["$stateProvider"],angular.module("fmInvoice").config(a)}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i){function j(a){l=[];for(var b=1;a>=b;b++)l[b]=!1}function k(a){for(var b in l)l[b]=!1;l[a]=!0}var l;a.init=function(){j(4),k(1)},a.active=function(a){return!!l[a]},f.query(function(b){a.projects=_.sortByAll(b,["company.name","name"])}),a.templates=h.active(),a.search={project:null,from:null,to:null,invoiced:!1,billable:!0},a.searchTimeRegistrations=function(){a.loading=!0,a.includeAllTimeRegistrations=!1,g.search({project:a.search.project,from:a.search.from?moment(a.search.from,"YYYY-MM-DD").format("YYYYMMDD"):null,to:a.search.to?moment(a.search.to,"YYYY-MM-DD").format("YYYYMMDD"):null,invoiced:a.search.invoiced,billable:a.search.billable},function(b){a.loading=!1,a.searched=!0,a.timeRegistrations=_.sortByAll(b,["date.numeric","from.numeric"])})},a.$watch("includeAllTimeRegistrations",function(b){a.timeRegistrations&&_.forEach(a.timeRegistrations,function(a){a.included=b})}),a.invoice={customer:{address:{}}},a.canGoto2=function(){return _.some(a.timeRegistrations,{included:!0})},a.gobackto2=function(){k(2)},a.goto2=function(){a.invoice.linkedTimeRegistrationIds=_.map(_.where(a.timeRegistrations,{included:!0}),function(a){return a.id}),a.invoice.lines=_.map(_.groupBy(_.where(a.timeRegistrations,{included:!0}),function(a){return a.projectId+"-"+a.task}),function(b){var c=_.reduce(_.map(b,"totalMinutes"),function(a,b){return a+b}),d=Math.round(c/60*100)/100,e=_.find(a.projects,"id",b[0].projectId),f=e?_.find(e.tasks,"name",b[0].task):null,g=f?parseInt(f.defaultRateInCents):0;return{description:e.name+" - "+f.name,quantity:d,vatPercentage:21,price:g/100,priceInCents:g}},0),k(2)},a.removeInvoiceLine=function(b){_.remove(a.invoice.lines,b)},a.addInvoiceLine=function(){a.invoice.lines.push({description:"",quantity:1,vatPercentage:21,price:0,priceInCents:0})},a.$watch("invoice.lines",function(a){_.forEach(a,function(a){a.priceInCents=Math.round(100*a.price),a.totalInCents=Math.round(a.quantity*a.priceInCents),a.total=a.totalInCents/100})},!0),a.goto3=function(){k(3)},a.gobackto3=function(){k(3)},a.$watch("invoice.templateId",function(b){var c=_.find(a.templates,"id",b);a.invoice.template=c?c.content:""}),a.$watch("invoice.displayDate",function(b){b?(a.invoice.displayCreditTerm=moment(b,"YYYY-MM-DD").add(30,"day").format("YYYY-MM-DD"),a.invoice.date=moment(b,"YYYY-MM-DD").format("YYYYMMDD")):(a.invoice.displayCreditTerm=null,a.invoice.date=null)}),a.$watch("invoice.displayCreditTerm",function(b){b?a.invoice.creditTerm=moment(b,"YYYY-MM-DD").format("YYYYMMDD"):a.invoice.creditTerm=null}),a.searchCustomer=function(){var b=d.open({templateUrl:"/modules/crm/views/searchcompany.html",controller:"SearchCompanyDialogController"});b.result.then(function(b){b&&(a.invoice.customer.name=b.name,a.invoice.customer.vatNumber=b.vatNumber,a.invoice.customer.number=b.number,a.invoice.customer.address.line1=b.address.line1,a.invoice.customer.address.line2=b.address.line2,a.invoice.customer.address.postalcode=b.address.postalcode,a.invoice.customer.address.city=b.address.city)})},a.goto4=function(){a.loading=!0,i.preview(a.invoice,function(b){a.invoicePreview=b,a.loading=!1,a.previewUrl=e.trustAsResourceUrl("/render/#!/invoicepreview?invoice="+window.encodeURIComponent(JSON.stringify(b)))}),k(4)},a.create=function(){i.save(a.invoice,function(){b.go("app.invoice_overview")})}}a.$inject=["$scope","$state","$stateParams","$modal","$sce","Project","TimeRegistration","Template","Invoice"],angular.module("fmInvoice").controller("CreateInvoiceController",a)}(),function(){"use strict";function a(a,b,c,d){a.year=moment(d.from,"YYYYMMDD").year(),a.getAllInvoices=function(){b.bydate({from:d.from,to:d.to},function(b){a.invoices=_.sortBy(b,function(a){return a.date.numeric})})},a.previous=function(){c.go("app.invoice_overview",{from:a.year-1+"0101",to:a.year-1+"1231"},{location:"replace"})},a.next=function(){c.go("app.invoice_overview",{from:a.year+1+"0101",to:a.year+1+"1231"},{location:"replace"})}}a.$inject=["$scope","Invoice","$state","$stateParams"],angular.module("fmInvoice").controller("InvoiceOverviewController",a)}(),function(){"use strict";function a(a,b,c,d,e){if(a.from=moment(d.from,"YYYYMMDD"),a.to=moment(d.to,"YYYYMMDD"),1===a.from.date()&&0===a.from.month()&&31===a.to.date()&&11===a.to.month()&&a.from.year()===a.to.year())a.title=a.from.format("YYYY"),a.previousFrom=moment(a.from).subtract(1,"year"),a.previousTo=moment(a.to).subtract(1,"year"),a.nextFrom=moment(a.from).add(1,"year"),a.nextTo=moment(a.to).add(1,"year");else if(1===a.from.date()&&moment(a.from).endOf("month").date()===a.to.date()&&a.from.month()===a.to.month()&&a.from.year()===a.to.year())a.title=a.from.format("MMMM YYYY"),a.previousFrom=moment(a.from).subtract(1,"month").startOf("month"),a.previousTo=moment(a.from).subtract(1,"month").endOf("month"),a.nextFrom=moment(a.from).add(1,"month").startOf("month"),a.nextTo=moment(a.from).add(1,"month").endOf("month");else{a.title=a.from.format("YYYY-MM-DD")+" - "+a.to.format("YYYY-MM-DD");var f=a.to.diff(a.from,"days")+1;a.previousFrom=moment(a.from).subtract(f,"days"),a.previousTo=moment(a.to).subtract(f,"days"),a.nextFrom=moment(a.from).add(f,"days"),a.nextTo=moment(a.to).add(f,"days")}a.weekStart=moment().startOf("isoWeek").format("YYYYMMDD"),a.weekEnd=moment().endOf("isoWeek").format("YYYYMMDD"),a.monthStart=moment().startOf("month").format("YYYYMMDD"),a.monthEnd=moment().endOf("month").format("YYYYMMDD"),a.yearStart=moment().startOf("year").format("YYYYMMDD"),a.yearEnd=moment().endOf("year").format("YYYYMMDD"),a.previous=function(){c.go("app.invoice_report",{from:a.previousFrom.format("YYYYMMDD"),to:a.previousTo.format("YYYYMMDD")},{location:"replace"})},a.next=function(){c.go("app.invoice_report",{from:a.nextFrom.format("YYYYMMDD"),to:a.nextTo.format("YYYYMMDD")},{location:"replace"})},a.refresh=function(){a.loading=!0,e.getinfoforperiodpercustomer({from:a.from.format("YYYYMMDD"),to:a.to.format("YYYYMMDD")},function(b){a.infoPerCustomer=b,a.invoiceGraph=_.map(b,function(a){return{label:a.company.name,data:a.totalWithoutVatInCents/100}}),a.totalWithoutVatInCents=_.sum(b,"totalWithoutVatInCents"),a.totalWithoutVat=a.totalWithoutVatInCents/100,a.hasInvoices=b&&b.length>0,a.loading=!1})}}a.$inject=["$scope","$location","$state","$stateParams","Invoice"],angular.module("fmInvoice").controller("InvoiceReportController",a)}(),function(){"use strict";function a(a){a.state("app.projects",{url:"/projects/overview",templateUrl:"modules/project/views/projects.html",controller:"ProjectsController"})}a.$inject=["$stateProvider"],angular.module("fmProject").config(a)}(),function(){"use strict";function a(a,b,c,d){function e(b){a.isBusy=!0,a.message=b}function f(){a.isBusy=!1,a.message=""}a.originalProject=d,a.newProject=void 0===d,d=d||{},a.project={companyId:d.companyId||"",name:d.name||"",description:d.description||""},a.isBusy=!1,a.message="",c.query(function(b){a.companies=_.sortBy(b,"name")}),a.ok=function(){e("Saving project...");var c=a.newProject?{}:{id:a.originalProject.id};b.save(c,a.project,function(b){f(),a.$close(b)},function(a){e("An error occurred...")})},a.cancel=function(){a.$dismiss("cancel")}}a.$inject=["$scope","Project","Company","toUpdate"],angular.module("fmProject").controller("ProjectDialogController",a)}(),function(){"use strict";function a(a,b,c){a.getAllProjects=function(){c.query(function(b){a.projects=_.sortByAll(b,["company.name","name"])})},a.openProject=function(c){var d=b.open({templateUrl:"/modules/project/views/editproject.html",controller:"ProjectDialogController",resolve:{toUpdate:function(){return c}}});d.result.then(function(b){var c=_.find(a.projects,{id:b.id});c?angular.copy(b,c):a.projects.push(b)})},a.openProjectTasks=function(c){var d=b.open({templateUrl:"/modules/project/views/projecttasksdialog.html",controller:"ProjectTasksDialogController",resolve:{toUpdate:function(){return c}}});d.result.then(function(b){var c=_.find(a.projects,{id:b.id});c&&angular.copy(b,c)})},a.hideProject=function(a){c.hide({id:a.id},function(){a.hidden=!0})},a.unhideProject=function(a){c.unhide({id:a.id},function(){a.hidden=!1})}}a.$inject=["$scope","$modal","Project"],angular.module("fmProject").controller("ProjectsController",a)}(),function(){"use strict";function a(a,b,c){function d(b){a.isBusy=!0,a.message=b}function e(){a.isBusy=!1,a.message=""}a.originalProject=c,c=c||{},a.project={tasks:_.map(c.tasks,function(a){return{name:a.name,defaultRateInCents:a.defaultRateInCents,defaultRate:a.defaultRateInCents?a.defaultRateInCents/100:a.defaultRateInCents}})},a.$watch("project.tasks",function(a){_.forEach(a,function(a){a.defaultRateInCents=Math.round(100*a.defaultRate)})},!0),a.isBusy=!1,a.message="",a.ok=function(){d("Saving project..."),b.changetasks({id:a.originalProject.id},a.project.tasks,function(b){e(),a.$close(b)},function(a){d("An error occurred...")})},a.cancel=function(){a.$dismiss("cancel")}}a.$inject=["$scope","Project","toUpdate"],angular.module("fmProject").controller("ProjectTasksDialogController",a)}(),function(){"use strict";function a(a){a.state("app.settings_templates",{url:"/settings/templates",templateUrl:"modules/settings/views/templates.html",controller:"TemplatesController"})}a.$inject=["$stateProvider"],angular.module("fmSettings").config(a)}(),function(){"use strict";function a(a,b){a.getAllTemplates=function(){a.templates=b.query()},a.openTemplate=function(b){a.template=b||{},a.newTemplate=void 0===b},a.template={},a.newTemplate=!0,a.saveTemplate=function(){var c=a.newTemplate?{}:{id:a.template.id};b.save(c,a.template,function(b){a.newTemplate&&(a.templates.push(b),a.template=b,a.newTemplate=!1)},function(a){alert(a)})}}a.$inject=["$scope","Template"],angular.module("fmSettings").controller("TemplatesController",a)}(),function(){"use strict";function a(a){a.state("app.time_overview",{url:"/time/overview/:date",templateUrl:"modules/time/views/overview.html",controller:"TimeRegistrationOverviewController",params:{date:function(){return moment().format("YYYYMMDD")}}}).state("app.time_report",{url:"/time/report/:from/:to",templateUrl:"modules/time/views/report.html",controller:"TimeRegistrationReportController",resolve:fm.vendor.resolve("flot","flot-plugins"),params:{from:function(){return moment().startOf("month").format("YYYYMMDD")},to:function(){return moment().endOf("month").format("YYYYMMDD")}}}).state("app.time_import",{url:"/time/import",templateUrl:"modules/time/views/import.html",controller:"TimeRegistrationImportController",resolve:fm.vendor.resolve("xlsx")}).state("app.time_export",{url:"/time/export/:from/:to",templateUrl:"modules/time/views/export.html",controller:"TimeRegistrationExportController",params:{from:function(){return moment().startOf("month").format("YYYYMMDD")},to:function(){return moment().endOf("month").format("YYYYMMDD")}}})}a.$inject=["$stateProvider"],angular.module("fmTime").config(a)}(),function(){"use strict";function a(a,b,c,d){a.from=moment(c.from,"YYYYMMDD"),a.to=moment(c.to,"YYYYMMDD"),a.hasTimeRegistrations=!1,a.loading=!1,a.from=moment(c.from,"YYYYMMDD"),a.to=moment(c.to,"YYYYMMDD"),a.thisWeek=moment().day(1).format("YYYYMMDD")+"/"+moment().day(7).format("YYYYMMDD"),a.lastWeek=moment().day(1).subtract(7,"days").format("YYYYMMDD")+"/"+moment().day(7).subtract(7,"days").format("YYYYMMDD"),a.thisMonth=moment().set("date",1).format("YYYYMMDD")+"/"+moment().set("date",moment().daysInMonth()).format("YYYYMMDD"),a.lastMonth=moment().set("date",1).subtract(1,"months").format("YYYYMMDD")+"/"+moment().subtract(1,"months").set("date",moment().subtract(1,"months").daysInMonth()).format("YYYYMMDD"),a.thisYear=moment().set("month",0).set("date",1).format("YYYYMMDD")+"/"+moment().set("month",11).set("date",31).format("YYYYMMDD"),a.lastYear=moment().set("month",0).set("date",1).subtract(1,"years").format("YYYYMMDD")+"/"+moment().set("month",11).set("date",31).subtract(1,"years").format("YYYYMMDD"),a.$watch("from",function(){a.displayFrom=a.from.format("YYYY-MM-DD")}),a.$watch("to",function(){a.displayTo=a.to.format("YYYY-MM-DD")}),a.changeFrom=function(b,c){a.from=moment(b,c)},a.changeTo=function(b,c){a.to=moment(b,c)},a.applyDate=function(){b.go("app.time_export",{from:a.from.format("YYYYMMDD"),to:a.to.format("YYYYMMDD")},{location:"replace"})},a.refresh=function(){a.loading=!0,d.byrange({from:a.from.format("YYYYMMDD"),to:a.to.format("YYYYMMDD")},function(b){var c=_.groupBy(b,function(a){return a.date.numeric});a.timeRegistrations=_.sortBy(_.map(c,function(a){return{date:_.first(a).date,items:_.sortBy(a,function(a){return a.from.numeric})}}),function(a){return a.date.numeric}),a.hasTimeRegistrations=a.timeRegistrations.length>0,a.loading=!1})}}a.$inject=["$scope","$state","$stateParams","TimeRegistration"],angular.module("fmTime").controller("TimeRegistrationExportController",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g){function h(a){m=[];for(var b=1;a>=b;b++)m[b]=!1}function i(a){for(var b in m)m[b]=!1;m[a]=!0}function j(a){return void 0!==a&&null!==a}function k(a){return parseInt(a.replace(/-/g,""),10)}function l(a){return parseInt(a.replace(":",""),10)}var m;a.init=function(){h(6),i(1)},a.active=function(a){return!!m[a]},f.active(function(b){var c=[],d=0;_.forEach(b,function(a){_.forEach(a.tasks,function(b){c.push({project:a,company:a.company,task:b,display:a.company.name+" - "+a.name+" - "+b.name,id:d++})})}),a.tasks=_.sortBy(c,"display")}),a.fileChanged=function(b){a.excel.sheets=[],a.excelFile=b[0],c.readFile(a.excelFile,!1).then(function(b){a.excel.sheets=b,i(2)})},a.excel={},a.excel.selectedSheetName=void 0,a.excel.selectedSheet=void 0,a.goto3=function(){a.excel.selectedSheet=a.excel.sheets[a.excel.selectedSheetName];for(var b=[],c=0;c<a.excel.selectedSheet.header.length;c++)b.push({key:c,value:a.excel.selectedSheet.header[c]});a.excel.selectedSheetHeader=b,i(3)},a.canGoto3=function(){return j(a.excel.selectedSheetName)},a.goto4=function(){a.excel.groupedRows=_.groupBy(a.excel.selectedSheet.data,function(b){return b[a.excel.selectedProjectColumn]+" - "+b[a.excel.selectedTaskColumn]}),a.excel.projectsInSheet=_.map(a.excel.groupedRows,function(b){return{project:b[0][a.excel.selectedProjectColumn],task:b[0][a.excel.selectedTaskColumn],display:b[0][a.excel.selectedProjectColumn]+" - "+b[0][a.excel.selectedTaskColumn]}}),i(4)},a.canGoto4=function(){return j(a.excel.selectedProjectColumn)&&j(a.excel.selectedTaskColumn)&&j(a.excel.selectedDateColumn)&&j(a.excel.selectedFromColumn)&&j(a.excel.selectedToColumn)&&j(a.excel.selectedDescriptionColumn)},a.goto5=function(){i(5)},a.canGoto5=function(){return _.every(a.excel.projectsInSheet,function(a){return j(a.mappedProjectAndTask)})},a.importing=!1,a["import"]=function(){var b=[];a.importing=!0,_.forEach(a.excel.groupedRows,function(c){var d=_.find(a.excel.projectsInSheet,function(b){return b.project===c[0][a.excel.selectedProjectColumn]&&b.task===c[0][a.excel.selectedTaskColumn]}).mappedProjectAndTask,e=_.find(a.tasks,{id:d}).project,f=_.find(a.tasks,{id:d}).task;_.forEach(c,function(c){b.push({companyId:e.companyId,projectId:e.id,task:f.name,description:c[a.excel.selectedDescriptionColumn],date:k(c[a.excel.selectedDateColumn]),
from:l(c[a.excel.selectedFromColumn]),to:l(c[a.excel.selectedToColumn]),billable:f.billable})})}),g.saveMultiple(b,function(b){a.importing=!1,a.timeRegistrationsImported=b,a.summaryTableParams.count(10),i(6)},function(b){a.importing=!1})},a.filterImportedTimeRegistrations=function(b,c){if(a.timeRegistrationsImported){var d=c.filter()?e("filter")(a.timeRegistrationsImported,c.filter()):a.timeRegistrationsImported,f=c.sorting()?e("orderBy")(d,c.orderBy()):d;c.total(f.length),b.resolve(f.slice((c.page()-1)*c.count(),c.page()*c.count()))}},a.summaryTableParams=new d({page:1,count:1},{getData:a.filterImportedTimeRegistrations})}a.$inject=["$scope","$state","XLSXReader","NgTableParams","$filter","Project","TimeRegistration"],angular.module("fmTime").controller("TimeRegistrationImportController",a)}(),function(){"use strict";function a(a,b,c,d,e,f){a.date=moment(e.date,"YYYYMMDD"),a.hasTimeRegistrations=!1,a.$watch("date",function(){a.displayDate=a.date.format("YYYY-MM-DD")}),a.nextDate=function(){d.go("app.time_overview",{date:moment(a.date.add(1,"days")).format("YYYYMMDD")},{location:"replace"})},a.previousDate=function(){d.go("app.time_overview",{date:a.date.subtract(1,"days").format("YYYYMMDD")},{location:"replace"})},a.changeDate=function(a,b){d.go("app.time_overview",{date:moment(a,b).format("YYYYMMDD")},{location:"replace"})},a.refresh=function(){f.bydate({date:a.date.format("YYYYMMDD")},function(b){a.hasTimeRegistrations=b.length>0,a.timeRegistrations=_.sortBy(b,function(a){return a.from.numeric})})},a.openTimeRegistration=function(c){var d=b.open({templateUrl:"/modules/time/views/timeregistrationdialog.html",controller:"TimeRegistrationDialogController",size:"lg",resolve:{toUpdate:function(){return c},date:function(){return a.date.format("YYYYMMDD")}}});d.result.then(function(b){if(b.deleted)_.remove(a.timeRegistrations,function(a){return a.id===b.deleted});else{var c=_.find(a.timeRegistrations,{id:b.id});c?angular.copy(b,c):a.timeRegistrations.push(b)}a.hasTimeRegistrations=a.timeRegistrations.length>0})}}a.$inject=["$scope","$modal","$location","$state","$stateParams","TimeRegistration"],angular.module("fmTime").controller("TimeRegistrationOverviewController",a)}(),function(){"use strict";function a(a,b,c,d,e){if(a.from=moment(d.from,"YYYYMMDD"),a.to=moment(d.to,"YYYYMMDD"),1===a.from.date()&&0===a.from.month()&&31===a.to.date()&&11===a.to.month()&&a.from.year()===a.to.year())a.title=a.from.format("YYYY"),a.previousFrom=moment(a.from).subtract(1,"year"),a.previousTo=moment(a.to).subtract(1,"year"),a.nextFrom=moment(a.from).add(1,"year"),a.nextTo=moment(a.to).add(1,"year");else if(1===a.from.date()&&moment(a.from).endOf("month").date()===a.to.date()&&a.from.month()===a.to.month()&&a.from.year()===a.to.year())a.title=a.from.format("MMMM YYYY"),a.previousFrom=moment(a.from).subtract(1,"month").startOf("month"),a.previousTo=moment(a.from).subtract(1,"month").endOf("month"),a.nextFrom=moment(a.from).add(1,"month").startOf("month"),a.nextTo=moment(a.from).add(1,"month").endOf("month");else{a.title=a.from.format("YYYY-MM-DD")+" - "+a.to.format("YYYY-MM-DD");var f=a.to.diff(a.from,"days")+1;a.previousFrom=moment(a.from).subtract(f,"days"),a.previousTo=moment(a.to).subtract(f,"days"),a.nextFrom=moment(a.from).add(f,"days"),a.nextTo=moment(a.to).add(f,"days")}a.weekStart=moment().startOf("isoWeek").format("YYYYMMDD"),a.weekEnd=moment().endOf("isoWeek").format("YYYYMMDD"),a.monthStart=moment().startOf("month").format("YYYYMMDD"),a.monthEnd=moment().endOf("month").format("YYYYMMDD"),a.yearStart=moment().startOf("year").format("YYYYMMDD"),a.yearEnd=moment().endOf("year").format("YYYYMMDD"),a.previous=function(){c.go("app.time_report",{from:a.previousFrom.format("YYYYMMDD"),to:a.previousTo.format("YYYYMMDD")},{location:"replace"})},a.next=function(){c.go("app.time_report",{from:a.nextFrom.format("YYYYMMDD"),to:a.nextTo.format("YYYYMMDD")},{location:"replace"})},a.refresh=function(){a.loading=!0,e.getinfoforperiod({from:a.from.format("YYYYMMDD"),to:a.to.format("YYYYMMDD")},function(b){a.summary=b,a.billableUnbillableGraph=[{label:"Billable",data:a.summary.billableMinutes,color:"#7266BA"},{label:"Unbillable",data:a.summary.unBillableMinutes,color:"#5D9CEC"}],a.summary.unBillableMinutes||a.summary.billableMinutes?a.hasHours=!0:a.hasHours=!1,a.loading=!1}),e.getinfoforperiodpertask({from:a.from.format("YYYYMMDD"),to:a.to.format("YYYYMMDD")},function(b){var c=_.groupBy(b,function(a){return JSON.stringify({c:a.companyId,p:a.projectId})});a.infoPerProject=_.sortBy(_.map(c,function(a){return{companyId:a[0].companyId,company:a[0].company,projectId:a[0].projectId,project:a[0].project,tasks:a}}),function(a){return a.company.name+a.project.name})})}}a.$inject=["$scope","$location","$state","$stateParams","TimeRegistration"],angular.module("fmTime").controller("TimeRegistrationReportController",a)}(),function(){"use strict";function a(a,b,c,d,e){function f(a){var b=Math.floor(a/100),c=Math.floor(a-100*b);return("00"+b).slice(-2)+":"+("00"+c).slice(-2)}function g(b){a.isBusy=!0,a.message=b}function h(){a.isBusy=!1,a.message=""}function i(a){return parseInt(a.replace(":",""),10)}a.$watch("timeRegistration.company",function(b,c){c&&b&&c.id!==b.id&&(a.timeRegistration.project=null,a.timeRegistration.task=null)}),a.$watch("timeRegistration.project",function(b,c){c&&b&&c.id!==b.id&&(a.timeRegistration.task=null)}),a.$watch("timeRegistration.task",function(){a.newTimeRegistration&&a.timeRegistration.task&&(a.timeRegistration.billable=a.timeRegistration.task.defaultRateInCents>0)}),a.isBusy=!1,a.message="",a.originalTimeRegistration=d,a.newTimeRegistration=void 0===d,d=d||{},a.timeRegistration={company:null,project:null,task:null,billable:d.billable||!1,description:d.description||"",from:d.from?f(d.from.numeric):"",to:d.to?f(d.to.numeric):""},a.projects=b.active(function(){a.companies=_.sortBy(_.map(_.groupBy(a.projects,function(a){return a.companyId}),function(a){return{id:a[0].companyId,name:a[0].company.name,projects:_.sortBy(a,"name")}}),"name"),d.companyId&&(a.timeRegistration.company=_.find(a.companies,{id:d.companyId})),d.projectId&&a.timeRegistration.company&&(a.timeRegistration.project=_.find(a.timeRegistration.company.projects,{id:d.projectId})),d.task&&a.timeRegistration.project&&(a.timeRegistration.task=_.find(a.timeRegistration.project.tasks,{name:d.task})),a.newTimeRegistration?a.projectEditable=!0:a.timeRegistration.task?a.projectEditable=!0:a.projectEditable=!1}),a.ok=function(){g("Saving time registration...");var b=a.newTimeRegistration?{}:{id:a.originalTimeRegistration.id};c.save(b,{companyId:a.timeRegistration.company.id,projectId:a.timeRegistration.project.id,task:a.timeRegistration.task.name,description:a.timeRegistration.description,billable:a.timeRegistration.billable,date:e,from:i(a.timeRegistration.from),to:i(a.timeRegistration.to)},function(b){h(),a.$close(b)},function(a){g("An error occurred...")})},a["delete"]=function(){g("Deleting time registration...");a.newTimeRegistration?{}:{id:a.originalTimeRegistration.id};c["delete"]({id:a.originalTimeRegistration.id},function(b){h(),a.$close(b)},function(a){g("An error occurred...")})},a.cancel=function(){a.$dismiss("cancel")}}a.$inject=["$scope","Project","TimeRegistration","toUpdate","date"],angular.module("fmTime").controller("TimeRegistrationDialogController",a)}();
//# sourceMappingURL=application.min.map