var ApplicationConfiguration=function(){"use strict";var applicationModuleName="freelancemanager",applicationModuleVendorDependencies=["ngRoute","ngAnimate","ngStorage","ngCookies","pascalprecht.translate","ui.bootstrap","ui.router","ui.utils","oc.lazyLoad","cfp.loadingBar","ngSanitize","ngResource"],registerModule=function(moduleName){var m=angular.module(moduleName,[]);return angular.module(applicationModuleName).requires.push(moduleName),m},resolve=function(){var _args=arguments;return{deps:["$ocLazyLoad","$q","APP_REQUIRES",function($ocLL,$q,appRequires){function andThen(_arg){return promise.then("function"==typeof _arg?_arg:function(){var whatToLoad=getRequired(_arg);return whatToLoad?$ocLL.load(whatToLoad):$.error("Route resolve: Bad resource name ["+_arg+"]")})}function getRequired(name){if(appRequires.modules)for(var m in appRequires.modules)if(appRequires.modules[m].name&&appRequires.modules[m].name===name)return appRequires.modules[m];return appRequires.scripts&&appRequires.scripts[name]}for(var promise=$q.when(1),i=0,len=_args.length;len>i;i++)promise=andThen(_args[i]);return promise}]}};return{applicationModuleName:applicationModuleName,applicationModuleVendorDependencies:applicationModuleVendorDependencies,registerModule:registerModule,resolve:resolve}}();angular.module(ApplicationConfiguration.applicationModuleName,ApplicationConfiguration.applicationModuleVendorDependencies),angular.module(ApplicationConfiguration.applicationModuleName).config(["$locationProvider",function($locationProvider){$locationProvider.hashPrefix("!")}]),angular.element(document).ready(function(){angular.bootstrap(document,[ApplicationConfiguration.applicationModuleName])}),ApplicationConfiguration.registerModule("account");var App=ApplicationConfiguration.registerModule("angle");ApplicationConfiguration.registerModule("core"),ApplicationConfiguration.registerModule("crm"),ApplicationConfiguration.registerModule("project"),ApplicationConfiguration.registerModule("time"),angular.module("account",["angular-jwt"]).factory("authInterceptor",["$rootScope","$q","$window",function($rootScope,$q,$window){"use strict";return{request:function(config){return config.headers=config.headers||{},$window.localStorage.token&&(config.headers.Authorization="Bearer "+$window.localStorage.token),config},response:function(response){return 401===response.status,response||$q.when(response)}}}]).config(["$httpProvider",function($httpProvider){"use strict";$httpProvider.interceptors.push("authInterceptor")}]).run(["$rootScope","$location","$window","jwtHelper",function($rootScope,$location,$window,jwtHelper){"use strict";$rootScope.$on("$stateChangeStart",function(event,nextRoute){var loggedIn=$window.localStorage.token&&!jwtHelper.isTokenExpired($window.localStorage.token);nextRoute.access&&nextRoute.access.requiredLogin&&!loggedIn&&$location.path("/login")})}]),angular.module("account").config(["$stateProvider",function($stateProvider){"use strict";$stateProvider.state("login",{url:"/login",templateUrl:"modules/account/views/login.html"}).state("app.account",{url:"/account",templateUrl:"modules/account/views/account.html",access:{requiredLogin:!0}})}]),angular.module("account").controller("AccountInfoController",["$scope","$window","jwtHelper","Account",function($scope,$window,jwtHelper,Account){"use strict";var token=jwtHelper.decodeToken($window.localStorage.token);Account.get({id:token.id}).$promise.then(function(response){$scope.account=response}),$scope.save=function(){Account.save(token.id,$scope.account)}}]),angular.module("account").controller("AuthenticateController",["$rootScope","$scope","$http","$window","$location","jwtHelper",function($rootScope,$scope,$http,$window,$location,jwtHelper){"use strict";$scope.user={email:"",password:""},$scope.error="",$scope.submit=function(){$http.post("/security/authenticate",$scope.user).success(function(data){var decrypted=jwtHelper.decodeToken(data.token);$window.localStorage.user=decrypted.fullName,$window.localStorage.token=data.token,$location.path("/")}).error(function(){delete $window.localStorage.token,delete $rootScope.$storage.user,$scope.error="Invalid email or password"})}}]),App.config(["$stateProvider","$urlRouterProvider","$controllerProvider","$compileProvider","$filterProvider","$provide","$ocLazyLoadProvider","APP_REQUIRES",function($stateProvider,$urlRouterProvider,$controllerProvider,$compileProvider,$filterProvider,$provide,$ocLazyLoadProvider,appRequires){"use strict";App.controller=$controllerProvider.register,App.directive=$compileProvider.directive,App.filter=$filterProvider.register,App.factory=$provide.factory,App.service=$provide.service,App.constant=$provide.constant,App.value=$provide.value,$ocLazyLoadProvider.config({debug:!1,events:!0,modules:appRequires.modules})}]).config(["$translateProvider",function($translateProvider){$translateProvider.useStaticFilesLoader({prefix:"i18n/",suffix:".json"}),$translateProvider.preferredLanguage("en"),$translateProvider.useLocalStorage()}]).config(["cfpLoadingBarProvider",function(cfpLoadingBarProvider){cfpLoadingBarProvider.includeBar=!0,cfpLoadingBarProvider.includeSpinner=!1,cfpLoadingBarProvider.latencyThreshold=500,cfpLoadingBarProvider.parentSelector=".wrapper > section"}]).controller("NullController",function(){}).run(["$rootScope","$state","$stateParams","$window","$templateCache",function($rootScope,$state,$stateParams,$window){$rootScope.$state=$state,$rootScope.$stateParams=$stateParams,$rootScope.$storage=$window.localStorage,$rootScope.app={name:"Freelance Manager",description:"A demo application in NodeJS",author:"Kevin Cornelis",year:(new Date).getFullYear(),layout:{isFixed:!0,isCollapsed:!1,isBoxed:!1,isRTL:!1},viewAnimation:"ng-fadeInUp"}}]),App.constant("APP_COLORS",{primary:"#5d9cec",success:"#27c24c",info:"#23b7e5",warning:"#ff902b",danger:"#f05050",inverse:"#131e26",green:"#37bc9b",pink:"#f532e5",purple:"#7266ba",dark:"#3a3f51",yellow:"#fad732","gray-darker":"#232735","gray-dark":"#3a3f51",gray:"#dde6e9","gray-light":"#e4eaec","gray-lighter":"#edf1f2"}).constant("APP_MEDIAQUERY",{desktopLG:1200,desktop:992,tablet:768,mobile:480}).constant("APP_REQUIRES",{scripts:{whirl:["lib/whirl/dist/whirl.css"],classyloader:["lib/jquery-classyloader/js/jquery.classyloader.min.js"],animo:["lib/animo.js/animo.js"],fastclick:["lib/fastclick/lib/fastclick.js"],modernizr:["lib/modernizr/modernizr.js"],animate:["lib/animate.css/animate.min.css"],icons:["lib/skycons/skycons.js","lib/fontawesome/css/font-awesome.min.css","lib/simple-line-icons/css/simple-line-icons.css","lib/weather-icons/css/weather-icons.min.css"],sparklines:["unmanagedbowerlib/sparklines/jquery.sparkline.min.js"],slider:["lib/seiyria-bootstrap-slider/dist/bootstrap-slider.min.js","lib/seiyria-bootstrap-slider/dist/css/bootstrap-slider.min.css"],wysiwyg:["lib/bootstrap-wysiwyg/bootstrap-wysiwyg.js","lib/bootstrap-wysiwyg/external/jquery.hotkeys.js"],slimscroll:["lib/slimScroll/jquery.slimscroll.min.js"],screenfull:["lib/screenfull/dist/screenfull.min.js"],"vector-map":["lib/ika.jvectormap/jquery-jvectormap-1.2.2.min.js","lib/ika.jvectormap/jquery-jvectormap-world-mill-en.js","lib/ika.jvectormap/jquery-jvectormap-us-mill-en.js","lib/ika.jvectormap/jquery-jvectormap-1.2.2.css"],loadGoogleMapsJS:["unmanagedbowerlib/gmap/load-google-maps.js"],"google-map":["lib/jQuery-gMap/jquery.gmap.min.js"],"flot-chart":["lib/Flot/jquery.flot.js"],"flot-chart-plugins":["lib/flot.tooltip/js/jquery.flot.tooltip.min.js","lib/Flot/jquery.flot.resize.js","lib/Flot/jquery.flot.pie.js","lib/Flot/jquery.flot.time.js","lib/Flot/jquery.flot.categories.js","lib/flot-spline/js/jquery.flot.spline.min.js"],"jquery-ui":["lib/jquery-ui/ui/core.js","lib/jquery-ui/ui/widget.js"],"jquery-ui-widgets":["lib/jquery-ui/ui/core.js","lib/jquery-ui/ui/widget.js","lib/jquery-ui/ui/mouse.js","lib/jquery-ui/ui/draggable.js","lib/jquery-ui/ui/droppable.js","lib/jquery-ui/ui/sortable.js","lib/jqueryui-touch-punch/jquery.ui.touch-punch.min.js"],moment:["lib/moment/min/moment-with-locales.min.js"],inputmask:["lib/jquery.inputmask/dist/jquery.inputmask.bundle.min.js"],flatdoc:["lib/flatdoc/flatdoc.js"],codemirror:["lib/codemirror/lib/codemirror.js","lib/codemirror/lib/codemirror.css"],"codemirror-plugins":["lib/codemirror/addon/mode/overlay.js","lib/codemirror/mode/markdown/markdown.js","lib/codemirror/mode/xml/xml.js","lib/codemirror/mode/gfm/gfm.js","lib/marked/lib/marked.js"],taginput:["lib/bootstrap-tagsinput/dist/bootstrap-tagsinput.css","lib/bootstrap-tagsinput/dist/bootstrap-tagsinput.min.js"],filestyle:["lib/bootstrap-filestyle/src/bootstrap-filestyle.js"],parsley:["lib/parsleyjs/dist/parsley.min.js"],datatables:["lib/datatables/media/js/jquery.dataTables.min.js","unmanagedbowerlib/datatable-bootstrap/css/dataTables.bootstrap.css"],"datatables-pugins":["unmanagedbowerlib/datatable-bootstrap/js/dataTables.bootstrap.js","unmanagedbowerlib/datatable-bootstrap/js/dataTables.bootstrapPagination.js","lib/datatables-colvis/js/dataTables.colVis.js","lib/datatables-colvis/css/dataTables.colVis.css"],fullcalendar:["lib/fullcalendar/dist/fullcalendar.min.js","lib/fullcalendar/dist/fullcalendar.css"],gcal:["lib/fullcalendar/dist/gcal.js"],datetime:["lib/clockpicker/dist/bootstrap-clockpicker.css","lib/bootstrap-datepicker/css/datepicker3.css","lib/clockpicker/dist/bootstrap-clockpicker.js","lib/bootstrap-datepicker/js/bootstrap-datepicker.js"],excel:["lib/js-xlsx/dist/xlsx.core.min.js"]},modules:[{name:"toaster",files:["lib/angularjs-toaster/toaster.js","lib/angularjs-toaster/toaster.css"]},{name:"localytics.directives",files:["lib/chosen_v1.2.0/chosen.jquery.min.js","lib/chosen_v1.2.0/chosen.min.css","lib/angular-chosen-localytics/chosen.js"]},{name:"ngDialog",files:["lib/ngDialog/js/ngDialog.min.js","lib/ngDialog/css/ngDialog.min.css","lib/ngDialog/css/ngDialog-theme-default.min.css"]},{name:"ngWig",files:["lib/ngWig/dist/ng-wig.min.js"]},{name:"ngTable",files:["lib/ng-table/ng-table.min.js","lib/ng-table/ng-table.min.css"]},{name:"ngTableExport",files:["lib/ng-table-export/ng-table-export.js"]}]}),App.controller("AppController",["$rootScope","$scope","$state","$translate","$window","$localStorage","$timeout","toggleStateService","colors","browser","cfpLoadingBar",function($rootScope,$scope,$state,$translate,$window,$localStorage,$timeout,toggle,colors,browser,cfpLoadingBar){"use strict";var thBar;$rootScope.$on("$stateChangeStart",function(){$(".wrapper > section").length&&!thBar&&cfpLoadingBar.start(),thBar=1}),$rootScope.$on("$stateChangeSuccess",function(event){event.targetScope.$watch("$viewContentLoaded",function(){cfpLoadingBar.complete(),thBar=null})}),$rootScope.$on("$stateNotFound",function(event,unfoundState){console.log(unfoundState.to),console.log(unfoundState.toParams),console.log(unfoundState.options)}),$rootScope.$on("$stateChangeError",function(event,toState,toParams,fromState,fromParams,error){console.log(error)}),$rootScope.$on("$stateChangeSuccess",function(){$window.scrollTo(0,0),$rootScope.currTitle=$state.current.title}),$rootScope.currTitle=$state.current.title,$rootScope.pageTitle=function(){return $rootScope.app.name+" - "+($rootScope.currTitle||$rootScope.app.description)},$rootScope.$watch("app.layout.isCollapsed",function(newValue){newValue===!1&&$rootScope.$broadcast("closeSidebarMenu")}),angular.isDefined($localStorage.layout)?$scope.app.layout=$localStorage.layout:$localStorage.layout=$scope.app.layout,$rootScope.$watch("app.layout",function(){$localStorage.layout=$scope.app.layout},!0),$scope.colorByName=colors.byName,$scope.toggleUserBlock=function(){$scope.$broadcast("toggleUserBlock")},$scope.language={listIsOpen:!1,available:{en:"English"},init:function(){var proposedLanguage=$translate.proposedLanguage()||$translate.use(),preferredLanguage=$translate.preferredLanguage();$scope.language.selected=$scope.language.available[proposedLanguage||preferredLanguage]},set:function(localeId){$translate.use(localeId),$scope.language.selected=$scope.language.available[localeId],$scope.language.listIsOpen=!$scope.language.listIsOpen}},$scope.language.init(),toggle.restoreState($(document.body)),$timeout(function(){$rootScope.mainViewAnimation=$rootScope.app.viewAnimation}),$rootScope.cancel=function($event){$event.stopPropagation()}}]),App.controller("SidebarController",["$rootScope","$scope","$state","$location","$http","$timeout","APP_MEDIAQUERY",function($rootScope,$scope,$state,$location,$http,$timeout,mq){function isMobile(){return $win.width()<mq.tablet}function isSidebarCollapsed(){return $body.hasClass("aside-collapsed")}var currentState=$rootScope.$state.current.name,$win=$(window),$body=($("html"),$("body"));$rootScope.$on("$stateChangeStart",function(event,toState){currentState=toState.name,$("body.aside-toggled").removeClass("aside-toggled"),$rootScope.$broadcast("closeSidebarMenu")}),$win.on("resize",function(){$body.removeClass(isMobile()?"aside-collapsed":"aside-toggled")});var isActive=function(item){if(item){if(item.sref&&"#"!=item.sref)return $state.is(item.sref)||$state.includes(item.sref);var foundActive=!1;return angular.forEach(item.submenu,function(value){isActive(value)&&(foundActive=!0)}),foundActive}};$scope.getMenuItemPropClasses=function(item){return(item.heading?"nav-heading":"")+(isActive(item)?" active":"")},$scope.loadSidebarMenu=function(){var menuJson="settings/sidebar-menu.json",menuURL=menuJson+"?v="+(new Date).getTime();$http.get(menuURL).success(function(items){$rootScope.menuItems=items}).error(function(){alert("Failure loading menu")})},$scope.loadSidebarMenu();var collapseList=[];$scope.addCollapse=function($index,item){collapseList[$index]=!isActive(item)},$scope.isCollapse=function($index){return collapseList[$index]},$scope.toggleCollapse=function($index,isParentItem){function closeAllBut(index){index+="";for(var i in collapseList)(0>index||index.indexOf(i)<0)&&(collapseList[i]=!0)}return isSidebarCollapsed()&&!isMobile()?!0:(angular.isDefined(collapseList[$index])?(collapseList[$index]=!collapseList[$index],closeAllBut($index)):isParentItem&&closeAllBut(-1),!0)}}]),App.directive("href",function(){return{restrict:"A",compile:function(element,attr){return function(scope,element){(attr.ngClick||""===attr.href||"#"===attr.href)&&(element.hasClass("dropdown-toggle")||element.on("click",function(e){e.preventDefault(),e.stopPropagation()}))}}}}),App.directive("animateEnabled",["$animate",function($animate){return{link:function(scope,element,attrs){scope.$watch(function(){return scope.$eval(attrs.animateEnabled,scope)},function(newValue){$animate.enabled(!!newValue,element)})}}}]),App.directive("classyloader",function($timeout){"use strict";var $scroller=$(window),inViewFlagClass="js-is-in-view";return{restrict:"A",link:function(scope,element){function checkLoaderInVIew(element,options){var offset=-20;!element.hasClass(inViewFlagClass)&&$.Utils.isInView(element,{topoffset:offset})&&startLoader(element,options)}function startLoader(element,options){element.ClassyLoader(options).addClass(inViewFlagClass)}$timeout(function(){var $element=$(element),options=$element.data();options&&(options.triggerInView?($scroller.scroll(function(){checkLoaderInVIew($element,options)}),checkLoaderInVIew($element,options)):startLoader($element,options))},0)}}}),App.directive("resetKey",["$state","$rootScope",function($state,$rootScope){"use strict";return{restrict:"A",scope:{resetKey:"="},link:function(scope,element,attrs){scope.resetKey=attrs.resetKey},controller:function($scope,$element){$element.on("click",function(e){e.preventDefault(),$scope.resetKey?(delete $rootScope.$storage[$scope.resetKey],$state.go($state.current,{},{reload:!0})):$.error("No storage key specified for reset.")})}}}]),App.directive("filestyle",function(){return{restrict:"A",controller:function($scope,$element){var $elem=$($element);$elem.filestyle({classInput:$elem.data("classinput")})}}}),App.directive("flatdoc",["$location",function(){return{restrict:"EA",template:"<div role='flatdoc'><div role='flatdoc-menu'></div><div role='flatdoc-content'></div></div>",link:function(scope,element,attrs){Flatdoc.run({fetcher:Flatdoc.file(attrs.src)});var $root=$("html, body");$(document).on("flatdoc:ready",function(){var docMenu=$('[role="flatdoc-menu"]');docMenu.find("a").on("click",function(e){e.preventDefault(),e.stopPropagation();var $this=$(this);docMenu.find("a.active").removeClass("active"),$this.addClass("active"),$root.animate({scrollTop:$(this.getAttribute("href")).offset().top-($(".topnavbar").height()+10)},800)})})}}}]),App.directive("formWizard",function($parse){"use strict";function Wizard(quantity,validate,element){var self=this;self.quantity=parseInt(quantity,10),self.validate=validate,self.element=element,self.init=function(){return self.createsteps(self.quantity),self.go(1),self},self.go=function(step){if(angular.isDefined(self.steps[step])){if(self.validate&&1!==step){var form=$(self.element),group=form.children().children("div").get(step-2);if(!1===form.parsley().validate(group.id))return!1}self.cleanall(),self.steps[step]=!0}},self.active=function(step){return!!self.steps[step]},self.cleanall=function(){for(var i in self.steps)self.steps[i]=!1},self.createsteps=function(q){self.steps=[];for(var i=1;q>=i;i++)self.steps[i]=!1}}return{restrict:"EA",scope:!0,link:function(scope,element,attribute){var validate=$parse(attribute.validateSteps)(scope),wiz=new Wizard(attribute.steps,!!validate,element);scope.wizard=wiz.init()}}}),App.directive("toggleFullscreen",function(){"use strict";return{restrict:"A",link:function(scope,element){element.on("click",function(e){e.preventDefault(),screenfull.enabled?(screenfull.toggle(),screenfull.isFullscreen?$(this).children("em").removeClass("fa-expand").addClass("fa-compress"):$(this).children("em").removeClass("fa-compress").addClass("fa-expand")):$.error("Fullscreen not enabled")})}}}),App.directive("gmap",["$window","gmap",function($window,gmap){"use strict";var MapStyles=[{featureType:"water",stylers:[{visibility:"on"},{color:"#bdd1f9"}]},{featureType:"all",elementType:"labels.text.fill",stylers:[{color:"#334165"}]},{featureType:"landscape",stylers:[{color:"#e9ebf1"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#c5c6c6"}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#fff"}]},{featureType:"road.local",elementType:"geometry",stylers:[{color:"#fff"}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#d8dbe0"}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#cfd5e0"}]},{featureType:"administrative",stylers:[{visibility:"on"},{lightness:33}]},{featureType:"poi.park",elementType:"labels",stylers:[{visibility:"on"},{lightness:20}]},{featureType:"road",stylers:[{color:"#d8dbe0",lightness:20}]}];return gmap.setStyle(MapStyles),$($window).resize(function(){gmap.autocenter()}),{restrict:"A",link:function(scope,element){gmap.init(element)}}}]),App.directive("loadCss",function(){"use strict";function createLink(uri){var linkId="autoloaded-stylesheet",oldLink=$("#"+linkId).attr("id",linkId+"-old");return $("head").append($("<link/>").attr({id:linkId,rel:"stylesheet",href:uri})),oldLink.length&&oldLink.remove(),$("#"+linkId)}return{restrict:"A",link:function(scope,element,attrs){element.on("click",function(e){element.is("a")&&e.preventDefault();var link,uri=attrs.loadCss;uri?(link=createLink(uri),link||$.error("Error creating stylesheet link element.")):$.error("No stylesheet location defined.")})}}}),App.directive("markdownarea",function(){"use strict";return{restrict:"A",link:function(scope,element,attrs){{var area=$(element),Markdownarea=$.fn.markdownarea;$.Utils.options(attrs.markdownarea),new Markdownarea(area,$.Utils.options(attrs.markdownarea))}}}}),function($,window,document){"use strict";var Markdownarea=function(element,options){var $element=$(element);$element.data("markdownarea")||(this.element=$element,this.options=$.extend({},Markdownarea.defaults,options),this.marked=this.options.marked||marked,this.CodeMirror=this.options.CodeMirror||CodeMirror,this.marked.setOptions({gfm:!0,tables:!0,breaks:!0,pedantic:!0,sanitize:!1,smartLists:!0,smartypants:!1,langPrefix:"lang-"}),this.init(),this.element.data("markdownarea",this))};$.extend(Markdownarea.prototype,{init:function(){var $this=this,tpl=Markdownarea.template;tpl=tpl.replace(/\{\:lblPreview\}/g,this.options.lblPreview),tpl=tpl.replace(/\{\:lblCodeview\}/g,this.options.lblCodeview),this.markdownarea=$(tpl),this.content=this.markdownarea.find(".uk-markdownarea-content"),this.toolbar=this.markdownarea.find(".uk-markdownarea-toolbar"),this.preview=this.markdownarea.find(".uk-markdownarea-preview").children().eq(0),this.code=this.markdownarea.find(".uk-markdownarea-code"),this.element.before(this.markdownarea).appendTo(this.code),this.editor=this.CodeMirror.fromTextArea(this.element[0],this.options.codemirror),this.editor.markdownarea=this,this.editor.on("change",function(){var render=function(){var value=$this.editor.getValue();$this.currentvalue=String(value),$this.element.trigger("markdownarea-before",[$this]),$this.applyPlugins(),$this.marked($this.currentvalue,function(err,markdown){if(err)throw err;$this.preview.html(markdown),$this.element.val($this.editor.getValue()).trigger("markdownarea-update",[$this])})};return render(),$.Utils.debounce(render,150)}()),this.code.find(".CodeMirror").css("height",this.options.height),this._buildtoolbar(),this.fit(),$(window).on("resize",$.Utils.debounce(function(){$this.fit()},200));var previewContainer=$this.preview.parent(),codeContent=this.code.find(".CodeMirror-sizer"),codeScroll=this.code.find(".CodeMirror-scroll").on("scroll",$.Utils.debounce(function(){if("tab"!=$this.markdownarea.attr("data-mode")){var codeHeight=codeContent.height()-codeScroll.height(),previewHeight=previewContainer[0].scrollHeight-previewContainer.height(),ratio=previewHeight/codeHeight,previewPostition=codeScroll.scrollTop()*ratio;previewContainer.scrollTop(previewPostition)}},10));this.markdownarea.on("click",".uk-markdown-button-markdown, .uk-markdown-button-preview",function(e){e.preventDefault(),"tab"==$this.markdownarea.attr("data-mode")&&($this.markdownarea.find(".uk-markdown-button-markdown, .uk-markdown-button-preview").removeClass("uk-active").filter(this).addClass("uk-active"),$this.activetab=$(this).hasClass("uk-markdown-button-markdown")?"code":"preview",$this.markdownarea.attr("data-active-tab",$this.activetab))}),this.preview.parent().css("height",this.code.height())},applyPlugins:function(){var $this=this,plugins=Object.keys(Markdownarea.plugins),plgs=Markdownarea.plugins;if(this.markers={},plugins.length){var lines=this.currentvalue.split("\n");plugins.forEach(function(name){this.markers[name]=[]},this);for(var line=0,max=lines.length;max>line;line++)!function(line){plugins.forEach(function(name){var i=0;lines[line]=lines[line].replace(plgs[name].identifier,function(){var replacement=plgs[name].cb({area:$this,found:arguments,line:line,pos:i++,uid:[name,line,i,(new Date).getTime()+"RAND"+Math.ceil(1e5*Math.random())].join("-"),replace:function(strwith){var src=this.area.editor.getLine(this.line),start=src.indexOf(this.found[0]),end=start+this.found[0].length;this.area.editor.replaceRange(strwith,{line:this.line,ch:start},{line:this.line,ch:end})}});return replacement})})}(line);this.currentvalue=lines.join("\n")}},_buildtoolbar:function(){if(this.options.toolbar&&this.options.toolbar.length){var $this=this,bar=[];this.options.toolbar.forEach(function(cmd){if(Markdownarea.commands[cmd]){var title=Markdownarea.commands[cmd].title?Markdownarea.commands[cmd].title:cmd;bar.push('<li><a data-markdownarea-cmd="'+cmd+'" title="'+title+'" data-toggle="tooltip">'+Markdownarea.commands[cmd].label+"</a></li>"),Markdownarea.commands[cmd].shortcut&&$this.registerShortcut(Markdownarea.commands[cmd].shortcut,Markdownarea.commands[cmd].action)}}),this.toolbar.html(bar.join("\n")),this.markdownarea.on("click","a[data-markdownarea-cmd]",function(){var cmd=$(this).data("markdownareaCmd");!cmd||!Markdownarea.commands[cmd]||$this.activetab&&"code"!=$this.activetab&&"fullscreen"!=cmd||Markdownarea.commands[cmd].action.apply($this,[$this.editor])})}},fit:function(){var mode=this.options.mode;"split"==mode&&this.markdownarea.width()<this.options.maxsplitsize&&(mode="tab"),"tab"==mode&&(this.activetab||(this.activetab="code",this.markdownarea.attr("data-active-tab",this.activetab)),this.markdownarea.find(".uk-markdown-button-markdown, .uk-markdown-button-preview").removeClass("uk-active").filter("code"==this.activetab?".uk-markdown-button-markdown":".uk-markdown-button-preview").addClass("uk-active")),this.editor.refresh(),this.preview.parent().css("height",this.code.height()),this.markdownarea.attr("data-mode",mode)},registerShortcut:function(combination,callback){var $this=this;combination=$.isArray(combination)?combination:[combination];for(var i=0,max=combination.length;max>i;i++){var map={};map[combination[i]]=function(){callback.apply($this,[$this.editor])},$this.editor.addKeyMap(map)}},getMode:function(){var pos=this.editor.getDoc().getCursor();return this.editor.getTokenAt(pos).state.base.htmlState?"html":"markdown"}}),$.fn.markdownarea=function(options){return this.each(function(){var ele=$(this);if(!ele.data("markdownarea")){new Markdownarea(ele,options)}})};var baseReplacer=function(replace,editor){var text=editor.getSelection(),markdown=replace.replace("$1",text);editor.replaceSelection(markdown,"end")};return Markdownarea.commands={fullscreen:{title:"Fullscreen",label:'<i class="fa fa-expand"></i>',action:function(editor){editor.markdownarea.markdownarea.toggleClass("uk-markdownarea-fullscreen"),$("html").toggleClass("markdownarea-fullscreen"),$("html, body").scrollTop(0);var wrap=editor.getWrapperElement();if(editor.markdownarea.markdownarea.hasClass("uk-markdownarea-fullscreen"))editor.state.fullScreenRestore={scrollTop:window.pageYOffset,scrollLeft:window.pageXOffset,width:wrap.style.width,height:wrap.style.height},wrap.style.width="",wrap.style.height=editor.markdownarea.content.height()+"px",document.documentElement.style.overflow="hidden";else{document.documentElement.style.overflow="";var info=editor.state.fullScreenRestore;wrap.style.width=info.width,wrap.style.height=info.height,window.scrollTo(info.scrollLeft,info.scrollTop)}editor.refresh(),editor.markdownarea.preview.parent().css("height",editor.markdownarea.code.height())}},bold:{title:"Bold",label:'<i class="fa fa-bold"></i>',shortcut:["Ctrl-B","Cmd-B"],action:function(editor){baseReplacer("html"==this.getMode()?"<strong>$1</strong>":"**$1**",editor)}},italic:{title:"Italic",label:'<i class="fa fa-italic"></i>',action:function(editor){baseReplacer("html"==this.getMode()?"<em>$1</em>":"*$1*",editor)}},strike:{title:"Strikethrough",label:'<i class="fa fa-strikethrough"></i>',action:function(editor){baseReplacer("html"==this.getMode()?"<del>$1</del>":"~~$1~~",editor)}},blockquote:{title:"Blockquote",label:'<i class="fa fa-quote-right"></i>',action:function(editor){baseReplacer("html"==this.getMode()?"<blockquote><p>$1</p></blockquote>":"> $1",editor)}},link:{title:"Link",label:'<i class="fa fa-link"></i>',action:function(editor){baseReplacer("html"==this.getMode()?'<a href="http://">$1</a>':"[$1](http://)",editor)}},picture:{title:"Picture",label:'<i class="fa fa-picture-o"></i>',action:function(editor){baseReplacer("html"==this.getMode()?'<img src="http://" alt="$1">':"![$1](http://)",editor)}},listUl:{title:"Unordered List",label:'<i class="fa fa-list-ul"></i>',action:function(editor){"markdown"==this.getMode()&&baseReplacer("* $1",editor)}},listOl:{title:"Ordered List",label:'<i class="fa fa-list-ol"></i>',action:function(editor){"markdown"==this.getMode()&&baseReplacer("1. $1",editor)}}},Markdownarea.defaults={mode:"split",height:500,maxsplitsize:1e3,codemirror:{mode:"gfm",tabMode:"indent",tabindex:"2",lineWrapping:!0,dragDrop:!1,autoCloseTags:!0,matchTags:!0},toolbar:["bold","italic","strike","link","picture","blockquote","listUl","listOl"],lblPreview:"Preview",lblCodeview:"Markdown"},Markdownarea.template='<div class="uk-markdownarea uk-clearfix" data-mode="split"><div class="uk-markdownarea-navbar"><ul class="uk-markdownarea-navbar-nav uk-markdownarea-toolbar"></ul><div class="uk-markdownarea-navbar-flip"><ul class="uk-markdownarea-navbar-nav"><li class="uk-markdown-button-markdown"><a>{:lblCodeview}</a></li><li class="uk-markdown-button-preview"><a>{:lblPreview}</a></li><li><a data-markdownarea-cmd="fullscreen" data-toggle="tooltip" title="Zen Mode"><i class="fa fa-expand"></i></a></li></ul></div></div><div class="uk-markdownarea-content"><div class="uk-markdownarea-code"></div><div class="uk-markdownarea-preview"><div></div></div></div></div>',Markdownarea.plugins={},Markdownarea.addPlugin=function(name,identifier,callback){Markdownarea.plugins[name]={identifier:identifier,cb:callback}},$.fn.markdownarea=Markdownarea,$(function(){$("textarea[data-uk-markdownarea]").each(function(){var obj,area=$(this);area.data("markdownarea")||(obj=new Markdownarea(area,$.Utils.options(area.attr("data-uk-markdownarea"))))})}),Markdownarea}(jQuery,window,document),App.directive("masked",function(){return{restrict:"A",controller:function($scope,$element){var $elem=$($element);$.fn.inputmask&&$elem.inputmask()}}}),App.directive("searchOpen",["navSearch",function(navSearch){"use strict";return{restrict:"A",controller:function($scope,$element){$element.on("click",function(e){e.stopPropagation()}).on("click",navSearch.toggle)}}}]).directive("searchDismiss",["navSearch",function(navSearch){"use strict";var inputSelector='.navbar-form input[type="text"]';return{restrict:"A",controller:function($scope,$element){$(inputSelector).on("click",function(e){e.stopPropagation()}).on("keyup",function(e){27==e.keyCode&&navSearch.dismiss()}),$(document).on("click",navSearch.dismiss),$element.on("click",function(e){e.stopPropagation()}).on("click",navSearch.dismiss)}}}]),App.directive("notify",function(){function notifyNow(elem){var $element=$(elem),message=$element.data("message"),options=$element.data("options");message||$.error("Notify: No message specified"),$.notify(message,options||{})}return{restrict:"A",controller:function($scope,$element){$element.on("click",function(e){e.preventDefault(),notifyNow($element)})}}}),function($){var containers={},messages={},notify=function(options){return"string"==$.type(options)&&(options={message:options}),arguments[1]&&(options=$.extend(options,"string"==$.type(arguments[1])?{status:arguments[1]}:arguments[1])),new Message(options).show()},closeAll=function(group,instantly){if(group)for(var id in messages)group===messages[id].group&&messages[id].close(instantly);else for(var id in messages)messages[id].close(instantly)},Message=function(options){this.options=$.extend({},Message.defaults,options),this.uuid="ID"+(new Date).getTime()+"RAND"+Math.ceil(1e5*Math.random()),this.element=$(['<div class="uk-notify-message alert-dismissable">','<a class="close">&times;</a>',"<div>"+this.options.message+"</div>","</div>"].join("")).data("notifyMessage",this),this.options.status&&(this.element.addClass("alert alert-"+this.options.status),this.currentstatus=this.options.status),this.group=this.options.group,messages[this.uuid]=this,containers[this.options.pos]||(containers[this.options.pos]=$('<div class="uk-notify uk-notify-'+this.options.pos+'"></div>').appendTo("body").on("click",".uk-notify-message",function(){$(this).data("notifyMessage").close()}))};return $.extend(Message.prototype,{uuid:!1,element:!1,timout:!1,currentstatus:"",group:!1,show:function(){if(!this.element.is(":visible")){var $this=this;containers[this.options.pos].show().prepend(this.element);var marginbottom=parseInt(this.element.css("margin-bottom"),10);return this.element.css({opacity:0,"margin-top":-1*this.element.outerHeight(),"margin-bottom":0}).animate({opacity:1,"margin-top":0,"margin-bottom":marginbottom},function(){if($this.options.timeout){var closefn=function(){$this.close()
};$this.timeout=setTimeout(closefn,$this.options.timeout),$this.element.hover(function(){clearTimeout($this.timeout)},function(){$this.timeout=setTimeout(closefn,$this.options.timeout)})}}),this}},close:function(instantly){var $this=this,finalize=function(){$this.element.remove(),containers[$this.options.pos].children().length||containers[$this.options.pos].hide(),delete messages[$this.uuid]};this.timeout&&clearTimeout(this.timeout),instantly?finalize():this.element.animate({opacity:0,"margin-top":-1*this.element.outerHeight(),"margin-bottom":0},function(){finalize()})},content:function(html){var container=this.element.find(">div");return html?(container.html(html),this):container.html()},status:function(status){return status?(this.element.removeClass("alert alert-"+this.currentstatus).addClass("alert alert-"+status),this.currentstatus=status,this):this.currentstatus}}),Message.defaults={message:"",status:"normal",timeout:5e3,group:null,pos:"top-center"},$.notify=notify,$.notify.message=Message,$.notify.closeAll=closeAll,notify}(jQuery,window,document),App.directive("now",["dateFilter","$interval",function(dateFilter,$interval){return{restrict:"E",link:function(scope,element,attrs){function updateTime(){var dt=dateFilter(new Date,format);element.text(dt)}var format=attrs.format;updateTime(),$interval(updateTime,1e3)}}}]),App.directive("paneltool",function($compile,$timeout){function getTemplate(elem,attrs){var temp="";return attrs=attrs||{},attrs.toolCollapse&&(temp+=templates.collapse.replace(/{{panelId}}/g,elem.parent().parent().attr("id"))),attrs.toolDismiss&&(temp+=templates.dismiss),attrs.toolRefresh&&(temp+=templates.refresh.replace(/{{spinner}}/g,attrs.toolRefresh)),temp}var templates={collapse:"<a href='#' panel-collapse='' data-toggle='tooltip' title='Collapse Panel' ng-click='{{panelId}} = !{{panelId}}' ng-init='{{panelId}}=false'>                 <em ng-show='{{panelId}}' class='fa fa-plus'></em>                 <em ng-show='!{{panelId}}' class='fa fa-minus'></em>               </a>",dismiss:"<a href='#' panel-dismiss='' data-toggle='tooltip' title='Close Panel'>               <em class='fa fa-times'></em>             </a>",refresh:"<a href='#' panel-refresh='' data-toggle='tooltip' data-spinner='{{spinner}}' title='Refresh Panel'>               <em class='fa fa-refresh'></em>             </a>"};return{restrict:"E",link:function(scope,element,attrs){var tools=scope.panelTools||attrs;$timeout(function(){element.html(getTemplate(element,tools)).show(),$compile(element.contents())(scope),element.addClass("pull-right")})}}}).directive("panelDismiss",function($q){"use strict";return{restrict:"A",controller:function($scope,$element){var removeEvent="panel-remove",removedEvent="panel-removed";$element.on("click",function(){function removeElement(){var deferred=$q.defer(),promise=deferred.promise;$scope.$emit(removeEvent,parent.attr("id"),deferred),promise.then(destroyMiddleware)}function destroyMiddleware(){$.support.animation?parent.animo({animation:"bounceOut"},destroyPanel):destroyPanel()}function destroyPanel(){var col=parent.parent();parent.remove(),col.filter(function(){var el=$(this);return el.is('[class*="col-"]:not(.sortable)')&&0===el.children("*").length}).remove(),$scope.$emit(removedEvent,parent.attr("id"))}var parent=$(this).closest(".panel");removeElement()})}}}).directive("panelCollapse",["$timeout",function($timeout){"use strict";function savePanelState(id,state){if(!id)return!1;var data=angular.fromJson(storage[storageKeyName]);data||(data={}),data[id]=state,storage[storageKeyName]=angular.toJson(data)}function loadPanelState(id){if(!id)return!1;var data=angular.fromJson(storage[storageKeyName]);return data?data[id]:void 0}var storage,storageKeyName="panelState";return{restrict:"A",controller:function($scope,$element){var $elem=$($element),parent=$elem.closest(".panel"),panelId=parent.attr("id");storage=$scope.$storage;var currentState=loadPanelState(panelId);void 0!==typeof currentState&&$timeout(function(){$scope[panelId]=currentState},10),$element.bind("click",function(){savePanelState(panelId,!$scope[panelId])})}}}]).directive("panelRefresh",function(){"use strict";return{restrict:"A",controller:function($scope,$element){function removeSpinner(ev,id){if(id){var newid="#"==id.charAt(0)?id:"#"+id;angular.element(newid).removeClass(whirlClass)}}var refreshEvent="panel-refresh",whirlClass="whirl",defaultSpinner="standard";$element.on("click",function(){var $this=$(this),panel=$this.parents(".panel").eq(0),spinner=$this.data("spinner")||defaultSpinner;panel.addClass(whirlClass+" "+spinner),$scope.$emit(refreshEvent,panel.attr("id"))}),$scope.$on("removeSpinner",removeSpinner)}}}),App.directive("animate",function(){"use strict";var $scroller=$(window).add("body, .wrapper");return{restrict:"A",link:function(scope,elem){function testAnimation(element){!element.hasClass("anim-running")&&$.Utils.isInView(element,{topoffset:offset})&&(element.addClass("anim-running"),setTimeout(function(){element.addClass("anim-done").animo({animation:animation,duration:.7})},delay))}var $elem=$(elem),offset=$elem.data("offset"),delay=$elem.data("delay")||100,animation=$elem.data("play")||"bounce";"undefined"!=typeof offset&&(testAnimation($elem),$scroller.scroll(function(){testAnimation($elem)})),$elem.on("click",function(){var $elem=$(this),targetSel=$elem.data("target"),animation=$elem.data("play")||"bounce",target=$(targetSel);target&&target&&target.animo({animation:animation})})}}}),App.directive("scrollable",function(){return{restrict:"EA",link:function(scope,elem,attrs){var defaultHeight=250;elem.slimScroll({height:attrs.height||defaultHeight})}}}),App.directive("sidebar",["$window","APP_MEDIAQUERY",function($window,mq){function toggleTouchItem($element){$element.siblings("li").removeClass("open").end().toggleClass("open")}function toggleMenuItem($listItem){removeFloatingNav();var ul=$listItem.children("ul");if(!ul.length)return $();if($listItem.hasClass("open"))return toggleTouchItem($listItem),$();var $aside=$(".aside"),mar=$scope.app.layout.isFixed?parseInt($aside.css("padding-top"),0):0,subNav=ul.clone().appendTo($aside);toggleTouchItem($listItem);var itemTop=$listItem.position().top+mar-$sidebar.scrollTop(),vwHeight=$win.height();return subNav.addClass("nav-floating").css({position:$scope.app.layout.isFixed?"fixed":"absolute",top:itemTop,bottom:subNav.outerHeight(!0)+itemTop>vwHeight?0:"auto"}),subNav.on("mouseleave",function(){toggleTouchItem($listItem),subNav.remove()}),subNav}function removeFloatingNav(){$(".sidebar-subnav.nav-floating").remove()}function isTouch(){return $html.hasClass("touch")}function isSidebarCollapsed(){return $body.hasClass("aside-collapsed")}function isMobile(){return $win.width()<mq.tablet}var $scope,$sidebar,$win=$($window),$html=$("html"),$body=$("body");return{restrict:"EA",template:'<nav class="sidebar" ng-transclude></nav>',transclude:!0,replace:!0,link:function(scope,element){$scope=scope,$sidebar=element;var eventName=isTouch()?"click":"mouseenter",subNav=$();$sidebar.on(eventName,".nav > li",function(){isSidebarCollapsed()&&!isMobile()&&(subNav.trigger("mouseleave"),subNav=toggleMenuItem($(this)))}),scope.$on("closeSidebarMenu",function(){removeFloatingNav(),$(".sidebar li.open").removeClass("open")})}}}]),App.directive("skycon",function(){return{restrict:"A",link:function(scope,element,attrs){var skycons=new Skycons({color:attrs.color||"white"});element.html('<canvas width="'+attrs.width+'" height="'+attrs.height+'"></canvas>'),skycons.add(element.children()[0],attrs.skycon),skycons.play()}}}),App.directive("sparkline",["$timeout","$window",function($timeout){"use strict";function initSparLine($element){var options=$element.data();options.type=options.type||"bar",options.disableHiddenCheck=!0,$element.sparkline("html",options),options.resize&&$(window).resize(function(){$element.sparkline("html",options)})}return{restrict:"EA",controller:function($scope,$element){var runSL=function(){initSparLine($element)};$timeout(runSL)}}}]),App.directive("checkAll",function(){"use strict";return{restrict:"A",controller:function($scope,$element){$element.on("change",function(){var $this=$(this),index=$this.index()+1,checkbox=$this.find('input[type="checkbox"]'),table=$this.parents("table");table.find("tbody > tr > td:nth-child("+index+') input[type="checkbox"]').prop("checked",checkbox[0].checked)})}}}),App.directive("tagsinput",function($timeout){return{restrict:"A",require:"ngModel",link:function(scope,element,attrs,ngModel){element.on("itemAdded itemRemoved",function(){ngModel.$viewValue&&ngModel.$viewValue.split&&(ngModel.$setViewValue(ngModel.$viewValue.split(",")),ngModel.$render())}),$timeout(function(){element.tagsinput()})}}}),App.directive("toggleState",["toggleStateService",function(toggle){"use strict";return{restrict:"A",link:function(scope,element,attrs){var $body=$("body");$(element).on("click",function(e){e.preventDefault();var classname=attrs.toggleState;classname&&($body.hasClass(classname)?($body.removeClass(classname),attrs.noPersist||toggle.removeState(classname)):($body.addClass(classname),attrs.noPersist||toggle.addState(classname)))})}}}]),App.directive("uiSlider",function(){return{restrict:"A",controller:function($scope,$element){var $elem=$($element);$.fn.slider&&$elem.slider()}}}),App.directive("validateForm",function(){return{restrict:"A",controller:function($scope,$element){var $elem=$($element);$.fn.parsley&&$elem.parsley()}}}),App.directive("vectorMap",["vectorMap",function(vectorMap){"use strict";var defaultColors={markerColor:"#23b7e5",bgColor:"transparent",scaleColors:["#878c9a"],regionFill:"#bbbec6"};return{restrict:"EA",link:function(scope,element,attrs){var mapHeight=attrs.height||"300",options={markerColor:attrs.markerColor||defaultColors.markerColor,bgColor:attrs.bgColor||defaultColors.bgColor,scale:attrs.scale||1,scaleColors:attrs.scaleColors||defaultColors.scaleColors,regionFill:attrs.regionFill||defaultColors.regionFill,mapName:attrs.mapName||"world_mill_en"};element.css("height",mapHeight),vectorMap.init(element,options,scope.seriesData,scope.markersData)}}}]),App.service("browser",function(){"use strict";var matched,browser,uaMatch=function(ua){ua=ua.toLowerCase();var match=/(opr)[\/]([\w.]+)/.exec(ua)||/(chrome)[ \/]([\w.]+)/.exec(ua)||/(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(ua)||/(webkit)[ \/]([\w.]+)/.exec(ua)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(ua)||/(msie) ([\w.]+)/.exec(ua)||ua.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(ua)||ua.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(ua)||[],platform_match=/(ipad)/.exec(ua)||/(iphone)/.exec(ua)||/(android)/.exec(ua)||/(windows phone)/.exec(ua)||/(win)/.exec(ua)||/(mac)/.exec(ua)||/(linux)/.exec(ua)||/(cros)/i.exec(ua)||[];return{browser:match[3]||match[1]||"",version:match[2]||"0",platform:platform_match[0]||""}};if(matched=uaMatch(window.navigator.userAgent),browser={},matched.browser&&(browser[matched.browser]=!0,browser.version=matched.version,browser.versionNumber=parseInt(matched.version)),matched.platform&&(browser[matched.platform]=!0),(browser.android||browser.ipad||browser.iphone||browser["windows phone"])&&(browser.mobile=!0),(browser.cros||browser.mac||browser.linux||browser.win)&&(browser.desktop=!0),(browser.chrome||browser.opr||browser.safari)&&(browser.webkit=!0),browser.rv){var ie="msie";matched.browser=ie,browser[ie]=!0}if(browser.opr){var opera="opera";matched.browser=opera,browser[opera]=!0}if(browser.safari&&browser.android){var android="android";matched.browser=android,browser[android]=!0}return browser.name=matched.browser,browser.platform=matched.platform,browser}),App.factory("colors",["APP_COLORS",function(colors){return{byName:function(name){return colors[name]||"#fff"}}}]),App.service("gmap",function(){return{setStyle:function(style){this.MapStyles=style},autocenter:function(){var refs=this.gMapRefs;if(refs&&refs.length)for(var r in refs){var mapRef=refs[r],currMapCenter=mapRef.getCenter();mapRef&&currMapCenter&&(google.maps.event.trigger(mapRef,"resize"),mapRef.setCenter(currMapCenter))}},init:function(element){var self=this,$element=$(element),addresses=$element.data("address")&&$element.data("address").split(";"),titles=$element.data("title")&&$element.data("title").split(";"),zoom=$element.data("zoom")||14,maptype=$element.data("maptype")||"ROADMAP",markers=[];if(addresses){for(var a in addresses)"string"==typeof addresses[a]&&markers.push({address:addresses[a],html:titles&&titles[a]||"",popup:!0});var options={controls:{panControl:!0,zoomControl:!0,mapTypeControl:!0,scaleControl:!0,streetViewControl:!0,overviewMapControl:!0},scrollwheel:!1,maptype:maptype,markers:markers,zoom:zoom},gMap=$element.gMap(options),ref=gMap.data("gMap.reference");self.gMapRefs||(self.gMapRefs=[]),self.gMapRefs.push(ref),void 0!==$element.data("styled")&&ref.setOptions({styles:self.MapStyles})}}}}),App.service("navSearch",function(){var navbarFormSelector="form.navbar-form";return{toggle:function(){var navbarForm=$(navbarFormSelector);navbarForm.toggleClass("open");var isOpen=navbarForm.hasClass("open");navbarForm.find("input")[isOpen?"focus":"blur"]()},dismiss:function(){$(navbarFormSelector).removeClass("open").find('input[type="text"]').blur().val("")}}}),App.service("toggleStateService",["$rootScope",function($rootScope){var storageKeyName="toggleState",WordChecker={hasWord:function(phrase,word){return new RegExp("(^|\\s)"+word+"(\\s|$)").test(phrase)},addWord:function(phrase,word){return this.hasWord(phrase,word)?void 0:phrase+(phrase?" ":"")+word},removeWord:function(phrase,word){return this.hasWord(phrase,word)?phrase.replace(new RegExp("(^|\\s)*"+word+"(\\s|$)*","g"),""):void 0}};return{addState:function(classname){var data=angular.fromJson($rootScope.$storage[storageKeyName]);data=data?WordChecker.addWord(data,classname):classname,$rootScope.$storage[storageKeyName]=angular.toJson(data)},removeState:function(classname){var data=$rootScope.$storage[storageKeyName];data&&(data=WordChecker.removeWord(data,classname),$rootScope.$storage[storageKeyName]=angular.toJson(data))},restoreState:function($elem){var data=angular.fromJson($rootScope.$storage[storageKeyName]);data&&$elem.addClass(data)}}}]),function($,window,doc){"use strict";var $html=$("html"),$win=$(window);$.support.transition=function(){var transitionEnd=function(){var name,element=doc.body||doc.documentElement,transEndEventNames={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(name in transEndEventNames)if(void 0!==element.style[name])return transEndEventNames[name]}();return transitionEnd&&{end:transitionEnd}}(),$.support.animation=function(){var animationEnd=function(){var name,element=doc.body||doc.documentElement,animEndEventNames={WebkitAnimation:"webkitAnimationEnd",MozAnimation:"animationend",OAnimation:"oAnimationEnd oanimationend",animation:"animationend"};for(name in animEndEventNames)if(void 0!==element.style[name])return animEndEventNames[name]}();return animationEnd&&{end:animationEnd}}(),$.support.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(callback){window.setTimeout(callback,1e3/60)},$.support.touch="ontouchstart"in window&&navigator.userAgent.toLowerCase().match(/mobile|tablet/)||window.DocumentTouch&&document instanceof window.DocumentTouch||window.navigator.msPointerEnabled&&window.navigator.msMaxTouchPoints>0||window.navigator.pointerEnabled&&window.navigator.maxTouchPoints>0||!1,$.support.mutationobserver=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver||null,$.Utils={},$.Utils.debounce=function(func,wait,immediate){var timeout;return function(){var context=this,args=arguments,later=function(){timeout=null,immediate||func.apply(context,args)},callNow=immediate&&!timeout;clearTimeout(timeout),timeout=setTimeout(later,wait),callNow&&func.apply(context,args)}},$.Utils.removeCssRules=function(selectorRegEx){var idx,idxs,stylesheet,_i,_j,_k,_len,_len1,_len2,_ref;selectorRegEx&&setTimeout(function(){try{for(_ref=document.styleSheets,_i=0,_len=_ref.length;_len>_i;_i++){for(stylesheet=_ref[_i],idxs=[],stylesheet.cssRules=stylesheet.cssRules,idx=_j=0,_len1=stylesheet.cssRules.length;_len1>_j;idx=++_j)stylesheet.cssRules[idx].type===CSSRule.STYLE_RULE&&selectorRegEx.test(stylesheet.cssRules[idx].selectorText)&&idxs.unshift(idx);for(_k=0,_len2=idxs.length;_len2>_k;_k++)stylesheet.deleteRule(idxs[_k])}}catch(_error){}},0)},$.Utils.isInView=function(element,options){var $element=$(element);if(!$element.is(":visible"))return!1;var window_left=$win.scrollLeft(),window_top=$win.scrollTop(),offset=$element.offset(),left=offset.left,top=offset.top;return options=$.extend({topoffset:0,leftoffset:0},options),top+$element.height()>=window_top&&top-options.topoffset<=window_top+$win.height()&&left+$element.width()>=window_left&&left-options.leftoffset<=window_left+$win.width()?!0:!1},$.Utils.options=function(string){if($.isPlainObject(string))return string;var start=string?string.indexOf("{"):-1,options={};if(-1!=start)try{options=new Function("","var json = "+string.substr(start)+"; return JSON.parse(JSON.stringify(json));")()}catch(e){}return options},$.Utils.events={},$.Utils.events.click=$.support.touch?"tap":"click",$.langdirection="rtl"==$html.attr("dir")?"right":"left",$(function(){if($.support.mutationobserver){var observer=new $.support.mutationobserver($.Utils.debounce(function(){$(doc).trigger("domready")},300));observer.observe(document.body,{childList:!0,subtree:!0})}}),$html.addClass($.support.touch?"touch":"no-touch")}(jQuery,window,document),App.service("vectorMap",function(){"use strict";return{init:function($element,opts,series,markers){$element.vectorMap({map:opts.mapName,backgroundColor:opts.bgColor,zoomMin:2,zoomMax:8,zoomOnScroll:!1,regionStyle:{initial:{fill:opts.regionFill,"fill-opacity":1,stroke:"none","stroke-width":1.5,"stroke-opacity":1},hover:{"fill-opacity":.8},selected:{fill:"blue"},selectedHover:{}},focusOn:{x:.4,y:.6,scale:opts.scale},markerStyle:{initial:{fill:opts.markerColor,stroke:opts.markerColor}},onRegionLabelShow:function(e,el,code){series&&series[code]&&el.html(el.html()+": "+series[code]+" visitors")},markers:markers,series:{regions:[{values:series,scale:opts.scaleColors,normalizeFunction:"polynomial"}]}})}}}),angular.module("core").config(["$stateProvider","$urlRouterProvider","APP_REQUIRES",function($stateProvider,$urlRouterProvider){"use strict";$urlRouterProvider.otherwise("/app/dashboard"),$stateProvider.state("app",{url:"/app","abstract":!0,templateUrl:"modules/core/views/app.html",controller:"AppController",resolve:ApplicationConfiguration.resolve("fastclick","modernizr","icons","screenfull","animo","sparklines","slimscroll","classyloader","toaster","whirl"),access:{requiredLogin:!0}}).state("app.dashboard",{url:"/dashboard",title:"Dashboard",templateUrl:"modules/core/views/dashboard.html",access:{requiredLogin:!0}})}]),angular.module("core").directive("fmAddErrorFor",function(){"use strict";return{link:function(scope,element,attrs){scope.$watch(attrs.fmAddErrorFor,function(formValue){scope.$watch(attrs.fmAddErrorFor+".$invalid",function(){formValue.$touched&&formValue.$invalid&&!formValue.$pristine?element.addClass("has-error"):element.removeClass("has-error")}),scope.$watch(attrs.fmAddErrorFor+".$touched",function(){formValue.$touched&&formValue.$invalid&&!formValue.$pristine?element.addClass("has-error"):element.removeClass("has-error")})})}}}),angular.module("core").directive("autofocus",["$timeout",function($timeout){"use strict";return{link:function(scope,element){$timeout(function(){element[0].focus()},100)}}}]),angular.module("core").directive("fmClockpicker",function(){"use strict";return{restrict:"A",link:function(scope,element){element.clockpicker()}}}),angular.module("core").directive("fmDatepicker",["$timeout",function(){"use strict";return{restrict:"A",require:"?ngModel",scope:{fmDatepickerDatechanged:"&"},link:function(scope,element,attrs){var position=attrs.fmDatepickerHPosition||"right";element.datepicker({format:attrs.fmDatepickerFormat||"yyyy-mm-dd",autoclose:!0,orientation:"auto "+position,todayBtn:"linked"}).on("changeDate",function(date){var dateTxt=date.format(attrs.fmDatepickerFormat||"yyyy-mm-dd");scope.fmDatepickerDatechanged&&scope.$apply(function(){scope.fmDatepickerDatechanged({date:dateTxt})})})}}}]),angular.module("core").directive("piechart",function(){"use strict";return{restrict:"E",link:function(scope,elem,attrs){var chart=null,options={series:{pie:{show:!0,radius:1,label:{show:!0,radius:2/3,formatter:function(label,series){return"<div style='font-size:8pt; text-align:center; padding:2px; color:white;'>"+label+"<br/>"+Math.round(series.percent)+"%</div>"},threshold:.1}}},legend:{show:!1}};scope.$watch(attrs.ngModel,function(v){chart?(chart.setData(v),chart.setupGrid(),chart.draw()):v&&(chart=$.plot(elem,v,options),elem.show())})}}}),angular.module("core").factory("Account",["$resource",function($resource){"use strict";return $resource("/api/public/accounts/:id",{id:"@id"})}]),angular.module("core").factory("Company",["$resource",function($resource){"use strict";return $resource("/api/public/companies/:id",{id:"@id"})}]),angular.module("core").factory("Invoice",["$resource",function($resource){"use strict";return $resource("/api/public/invoices/:id",{id:"@id"})}]),angular.module("core").factory("Project",["$resource",function($resource){"use strict";return $resource("/api/public/projects/:id",{id:"@id"},{active:{method:"GET",url:"/api/public/projects/active",isArray:!0},hide:{method:"POST",url:"/api/public/projects/:id/hide",isArray:!1},unhide:{method:"POST",url:"/api/public/projects/:id/unhide",isArray:!1},changetasks:{method:"POST",url:"/api/public/projects/:id/changetasks",isArray:!1}})}]),angular.module("core").factory("TimeRegistration",["$resource",function($resource){"use strict";return $resource("/api/public/timeregistrations/:id",{id:"@id"},{bydate:{method:"GET",url:"/api/public/timeregistrations/bydate/:date",params:{date:"@date"},isArray:!0},byrange:{method:"GET",url:"/api/public/timeregistrations/byrange/:from/:to",params:{from:"@from",to:"@to"},isArray:!0},uninvoiced:{method:"GET",url:"/api/public/timeregistrations/uninvoiced",isArray:!0},getinfo:{method:"GET",url:"/api/public/timeregistrations/getinfo/:from/:to",params:{from:"@from",to:"@to"}},save:{method:"POST",url:"/api/public/timeregistrations",isArray:!0}})}]),angular.module("core").factory("XLSXReader",["$q","$rootScope",function($q){"use strict";function convertWorkbook(workbook){var sheets={};return _.forEachRight(workbook.SheetNames,function(sheetName){var sheet=workbook.Sheets[sheetName];sheets[sheetName]=convertSheet(sheet)}),sheets}function convertSheet(sheet){var range=XLSX.utils.decode_range(sheet["!ref"]),sheetData=[],header=[];return _.forEachRight(_.range(range.s.r,range.e.r+1),function(row){var rowData=[];_.forEachRight(_.range(range.s.c,range.e.c+1),function(column){var cellIndex=XLSX.utils.encode_cell({c:column,r:row}),cell=sheet[cellIndex];rowData[column]=cell?cell.v:void 0}),0==row?header=rowData:sheetData[row-1]=rowData}),{header:header,data:sheetData,name:sheet.name,col_size:range.e.c+1,row_size:range.e.r}}var service=function(data){angular.extend(this,data)};return service.readFile=function(file){var deferred=$q.defer(),reader=new FileReader;return reader.onload=function(e){var data=e.target.result,workbook=XLSX.read(data,{type:"binary"});deferred.resolve(convertWorkbook(workbook))},reader.readAsBinaryString(file),deferred.promise},service}]),angular.module("core").filter("formatdate",function(){"use strict";return function(a){return _.has(a,"year")&&_.has(a,"month")&&_.has(a,"day")?a.year+"-"+("00"+a.month).slice(-2)+"-"+("00"+a.day).slice(-2):"-"}}),angular.module("core").filter("formattime",function(){"use strict";return function(a){if(_.has(a,"hour")&&_.has(a,"minutes"))return("00"+a.hour).slice(-2)+":"+("00"+a.minutes).slice(-2);if(_.isNumber(a)){var hour=Math.floor(a/60),minutes=Math.floor(a-60*hour);return hour>99?hour+":"+("00"+minutes).slice(-2):("00"+hour).slice(-2)+":"+("00"+minutes).slice(-2)}return"-"}}),angular.module("core").filter("moment",function(){"use strict";return function(date,format){return date.format(format)}}),angular.module("crm").config(["$stateProvider",function($stateProvider){"use strict";$stateProvider.state("app.companies",{url:"/crm/companies",templateUrl:"modules/crm/views/companies.html",controller:"CompaniesController",access:{requiredLogin:!0}})}]),angular.module("crm").controller("CompaniesController",["$scope","$modal","Company",function($scope,$modal,Company){"use strict";$scope.getAllCompanies=function(){$scope.companies=Company.query()},$scope.openCompany=function(company){var createDialog=$modal.open({templateUrl:"/modules/crm/views/editcompany.html",controller:"CompanyDialogController",resolve:{toUpdate:function(){return company}}});createDialog.result.then(function(company){var c=_.find($scope.companies,{id:company.id});c?angular.copy(company,c):$scope.companies.push(company)})}}]),angular.module("crm").controller("CompanyDialogController",["$scope","Company","toUpdate",function($scope,Company,toUpdate){"use strict";function showMessage(message){$scope.isBusy=!0,$scope.message=message}function hideMessage(){$scope.isBusy=!1,$scope.message=""}$scope.originalCompany=toUpdate,$scope.newCompany=void 0==toUpdate,toUpdate=toUpdate||{},$scope.company={name:toUpdate.name||""},$scope.isBusy=!1,$scope.message="",$scope.ok=function(){showMessage("Saving company...");var id=$scope.newCompany?{}:{id:$scope.originalCompany.id};Company.save(id,$scope.company,function(data){hideMessage(),$scope.$close(data)},function(){showMessage("An error occurred...")})},$scope.cancel=function(){$scope.$dismiss("cancel")}}]),angular.module("project").config(["$stateProvider",function($stateProvider){"use strict";$stateProvider.state("app.projects",{url:"/projects/overview",templateUrl:"modules/project/views/projects.html",controller:"ProjectsController",access:{requiredLogin:!0}})}]),angular.module("project").controller("ProjectDialogController",["$scope","Project","Company","toUpdate",function($scope,Project,Company,toUpdate){"use strict";function showMessage(message){$scope.isBusy=!0,$scope.message=message}function hideMessage(){$scope.isBusy=!1,$scope.message=""}$scope.originalProject=toUpdate,$scope.newProject=void 0==toUpdate,toUpdate=toUpdate||{},$scope.project={companyId:toUpdate.companyId||"",name:toUpdate.name||"",description:toUpdate.description||""},$scope.isBusy=!1,$scope.message="",$scope.companies=Company.query(),$scope.ok=function(){showMessage("Saving project...");var id=$scope.newProject?{}:{id:$scope.originalProject.id};Project.save(id,$scope.project,function(data){hideMessage(),$scope.$close(data)},function(){showMessage("An error occurred...")})},$scope.cancel=function(){$scope.$dismiss("cancel")}}]),angular.module("project").controller("ProjectsController",["$scope","$modal","Project",function($scope,$modal,Project){"use strict";$scope.getAllProjects=function(){$scope.projects=Project.query()},$scope.openProject=function(project){var createDialog=$modal.open({templateUrl:"/modules/project/views/editproject.html",controller:"ProjectDialogController",resolve:{toUpdate:function(){return project}}});createDialog.result.then(function(project){var p=_.find($scope.projects,{id:project.id});p?angular.copy(project,p):$scope.projects.push(project)})},$scope.openProjectTasks=function(project){var createDialog=$modal.open({templateUrl:"/modules/project/views/projecttasksdialog.html",controller:"ProjectTasksDialogController",resolve:{toUpdate:function(){return project}}});createDialog.result.then(function(project){var p=_.find($scope.projects,{id:project.id});p&&angular.copy(project,p)})},$scope.hideProject=function(project){Project.hide({id:project.id},function(){project.hidden=!0})},$scope.unhideProject=function(project){Project.unhide({id:project.id},function(){project.hidden=!1})}}]),angular.module("project").controller("ProjectTasksDialogController",["$scope","Project","toUpdate",function($scope,Project,toUpdate){"use strict";function showMessage(message){$scope.isBusy=!0,$scope.message=message}function hideMessage(){$scope.isBusy=!1,$scope.message=""}$scope.originalProject=toUpdate,toUpdate=toUpdate||{},$scope.project={tasks:_.map(toUpdate.tasks,function(t){return{name:t.name,defaultRateInCents:t.defaultRateInCents}})},$scope.isBusy=!1,$scope.message="",$scope.ok=function(){showMessage("Saving project..."),Project.changetasks({id:$scope.originalProject.id},$scope.project.tasks,function(data){hideMessage(),$scope.$close(data)},function(){showMessage("An error occurred...")})},$scope.cancel=function(){$scope.$dismiss("cancel")}}]),angular.module("time").config(["$stateProvider","$urlRouterProvider",function($stateProvider){"use strict";$stateProvider.state("app.time_overview",{url:"/time/overview/:date",templateUrl:"modules/time/views/overview.html",controller:"OverviewController",access:{requiredLogin:!0},resolve:ApplicationConfiguration.resolve("datetime"),onEnter:function($state,$stateParams){$stateParams.date||$state.go("app.time_overview",{date:(new moment).format("YYYYMMDD")},{location:"replace"})}}).state("app.time_report",{url:"/time/report/:from/:to",templateUrl:"modules/time/views/report.html",controller:"ReportController",access:{requiredLogin:!0},resolve:ApplicationConfiguration.resolve("flot-chart","flot-chart-plugins"),onEnter:function($state,$stateParams){$stateParams.from&&$stateParams.to||$state.go("app.time_report",{from:(new moment).startOf("month").format("YYYYMMDD"),to:(new moment).endOf("month").format("YYYYMMDD")},{location:"replace"})}}).state("app.time_import",{url:"/time/import",templateUrl:"modules/time/views/import.html",controller:"ImportController",resolve:ApplicationConfiguration.resolve("excel","ngTable"),access:{requiredLogin:!0}}).state("app.time_export",{url:"/time/export/:from/:to",templateUrl:"modules/time/views/export.html",controller:"ExportController",access:{requiredLogin:!0},resolve:ApplicationConfiguration.resolve("ngTable","datetime"),onEnter:function($state,$stateParams){$stateParams.from&&$stateParams.to||$state.go("app.time_export",{from:(new moment).startOf("month").format("YYYYMMDD"),to:(new moment).endOf("month").format("YYYYMMDD")},{location:"replace"})}})}]),angular.module("time").controller("ExportController",["$scope","$location","$stateParams","TimeRegistration",function($scope,$location,$stateParams,TimeRegistration){"use strict";$scope.from=new moment($stateParams.from,"YYYYMMDD"),$scope.to=new moment($stateParams.to,"YYYYMMDD"),$scope.hasTimeRegistrations=!1,$scope.loading=!1,$scope.from=new moment($stateParams.from,"YYYYMMDD"),$scope.to=new moment($stateParams.to,"YYYYMMDD"),$scope.thisWeek=(new moment).day(1).format("YYYYMMDD")+"/"+(new moment).day(7).format("YYYYMMDD"),$scope.lastWeek=(new moment).day(1).subtract("days",7).format("YYYYMMDD")+"/"+(new moment).day(7).subtract("days",7).format("YYYYMMDD"),$scope.thisMonth=(new moment).set("date",1).format("YYYYMMDD")+"/"+(new moment).set("date",(new moment).daysInMonth()).format("YYYYMMDD"),$scope.lastMonth=(new moment).set("date",1).subtract("months",1).format("YYYYMMDD")+"/"+(new moment).subtract("months",1).set("date",(new moment).subtract("months",1).daysInMonth()).format("YYYYMMDD"),$scope.thisYear=(new moment).set("month",0).set("date",1).format("YYYYMMDD")+"/"+(new moment).set("month",11).set("date",31).format("YYYYMMDD"),$scope.lastYear=(new moment).set("month",0).set("date",1).subtract("years",1).format("YYYYMMDD")+"/"+(new moment).set("month",11).set("date",31).subtract("years",1).format("YYYYMMDD"),$scope.$watch("from",function(){$scope.displayFrom=$scope.from.format("YYYY-MM-DD")
}),$scope.$watch("to",function(){$scope.displayTo=$scope.to.format("YYYY-MM-DD")}),$scope.changeFrom=function(date,format){$scope.from=new moment(date,format)},$scope.changeTo=function(date,format){$scope.to=new moment(date,format)},$scope.applyDate=function(){$location.path("/app/time/export/"+$scope.from.format("YYYYMMDD")+"/"+$scope.to.format("YYYYMMDD")).replace()},$scope.refresh=function(){$scope.loading=!0,TimeRegistration.byrange({from:$scope.from.format("YYYYMMDD"),to:$scope.to.format("YYYYMMDD")},function(tr){var grouped=_.groupBy(tr,function(i){return i.date.numeric});$scope.timeRegistrations=_.sortBy(_.map(grouped,function(g){return{date:_.first(g).date,items:g}}),function(i){return i.date.numeric}),$scope.hasTimeRegistrations=$scope.timeRegistrations.length>0,$scope.loading=!1})}}]),angular.module("time").controller("ImportController",["$scope","$state","XLSXReader","ngTableParams","$filter","Project","TimeRegistration",function($scope,$state,XLSXReader,ngTableParams,$filter,Project,TimeRegistration){"use strict";function createsteps(q){steps=[];for(var i=1;q>=i;i++)steps[i]=!1}function activate(step){for(var i in steps)steps[i]=!1;steps[step]=!0}function convertDisplayDateToNumeric(date){return parseInt(date.replace(/-/g,""),10)}function convertDisplayTimeToNumeric(time){return parseInt(time.replace(":",""),10)}var steps;$scope.init=function(){createsteps(4),activate(1)},$scope.active=function(step){return!!steps[step]},Project.active(function(projects){var tasks=[],id=0;_.forEach(projects,function(p){_.forEach(p.tasks,function(t){tasks.push({project:p,task:t,display:p.name+" - "+t.name,id:id++})})}),$scope.tasks=tasks}),$scope.fileChanged=function(files){$scope.excelSheets=[],$scope.excelFile=files[0],XLSXReader.readFile($scope.excelFile,$scope.showPreview).then(function(xlsxData){$scope.excelSheets=xlsxData,activate(2)})},$scope.selectedSheetName=void 0,$scope.selectedSheet=void 0,$scope.goto3=function(){$scope.selectedSheet=$scope.excelSheets[$scope.selectedSheetName];for(var selectedSheetHeader=[],i=0;i<$scope.selectedSheet.header.length;i++)selectedSheetHeader.push({key:i,value:$scope.selectedSheet.header[i]});$scope.selectedSheetHeader=selectedSheetHeader,activate(3)},$scope.canGoto3=function(){return null!=$scope.selectedSheetName},$scope.goto4=function(){$scope.groupedRows=_.groupBy($scope.selectedSheet.data,function(r){return r[$scope.selectedProjectColumn]+" - "+r[$scope.selectedTaskColumn]}),$scope.projectsInExcelSheet=_.map($scope.groupedRows,function(g){return{project:g[0][$scope.selectedProjectColumn],task:g[0][$scope.selectedTaskColumn],display:g[0][$scope.selectedProjectColumn]+" - "+g[0][$scope.selectedTaskColumn]}}),activate(4)},$scope.canGoto4=function(){return null!=$scope.selectedProjectColumn&&null!=$scope.selectedTaskColumn&&null!=$scope.selectedDateColumn&&null!=$scope.selectedFromColumn&&null!=$scope.selectedToColumn&&null!=$scope.selectedDescriptionColumn},$scope.goto5=function(){activate(5)},$scope.canGoto5=function(){return _.every($scope.projectsInExcelSheet,function(p){return null!=p.mappedProjectAndTask})},$scope.importing=!1,$scope["import"]=function(){var registrations=[];$scope.importing=!0,_.forEach($scope.groupedRows,function(groupedRow){var selectedProjectTask=_.first(_.where($scope.projectsInExcelSheet,function(p){return p.project==groupedRow[0][$scope.selectedProjectColumn]&&p.task==groupedRow[0][$scope.selectedTaskColumn]})).mappedProjectAndTask,project=$scope.tasks[selectedProjectTask].project,task=$scope.tasks[selectedProjectTask].task;_.forEach(groupedRow,function(row){registrations.push({companyId:project.companyId,projectId:project.id,task:task.name,description:row[$scope.selectedDescriptionColumn],date:convertDisplayDateToNumeric(row[$scope.selectedDateColumn]),from:convertDisplayTimeToNumeric(row[$scope.selectedFromColumn]),to:convertDisplayTimeToNumeric(row[$scope.selectedToColumn])})})}),TimeRegistration.save(registrations,function(data){$scope.importing=!1,$scope.timeRegistrationsImported=data,$scope.summaryTableParams.count(10),activate(6)},function(){$scope.importing=!1})},$scope.summaryTableParams=new ngTableParams({page:1,count:1},{getData:function($defer,params){if($scope.timeRegistrationsImported){var filteredData=params.filter()?$filter("filter")($scope.timeRegistrationsImported,params.filter()):$scope.timeRegistrationsImported,orderedData=params.sorting()?$filter("orderBy")(filteredData,params.orderBy()):$scope.timeRegistrationsImported;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}}})}]),angular.module("time").controller("OverviewController",["$scope","$modal","$location","$state","$stateParams","TimeRegistration",function($scope,$modal,$location,$state,$stateParams,TimeRegistration){"use strict";$scope.date=new moment($stateParams.date,"YYYYMMDD"),$scope.hasTimeRegistrations=!1,$scope.$watch("date",function(){$scope.displayDate=$scope.date.format("YYYY-MM-DD")}),$scope.nextDate=function(){$scope.date=new moment($scope.date.add(1,"days")),$state.go("app.time_overview",{date:$scope.date.format("YYYYMMDD")},{location:"replace"})},$scope.previousDate=function(){$scope.date=new moment($scope.date.subtract(1,"days")),$state.go("app.time_overview",{date:$scope.date.format("YYYYMMDD")},{location:"replace"})},$scope.changeDate=function(date,format){$scope.date=new moment(date,format),$state.go("app.time_overview",{date:$scope.date.format("YYYYMMDD")},{location:"replace"})},$scope.refresh=function(){TimeRegistration.bydate({date:$scope.date.format("YYYYMMDD")},function(timeRegistrations){$scope.hasTimeRegistrations=timeRegistrations.length>0,$scope.timeRegistrations=_.sortBy(timeRegistrations,function(i){return i.from.numeric})})},$scope.openTimeRegistration=function(timeRegistration){var createDialog=$modal.open({templateUrl:"/modules/time/views/timeregistrationdialog.html",controller:"TimeRegistrationDialogController",size:"lg",resolve:{toUpdate:function(){return timeRegistration},date:function(){return $scope.date.format("YYYYMMDD")}}});createDialog.result.then(function(timeRegistration){var c=_.find($scope.timeRegistrations,{id:timeRegistration.id});c?angular.copy(timeRegistration,c):$scope.timeRegistrations.push(timeRegistration),$scope.hasTimeRegistrations=$scope.timeRegistrations.length>0})}}]),angular.module("time").controller("ReportController",["$scope","$location","$state","$stateParams","TimeRegistration",function($scope,$location,$state,$stateParams,TimeRegistration){"use strict";if($scope.from=new moment($stateParams.from,"YYYYMMDD"),$scope.to=new moment($stateParams.to,"YYYYMMDD"),1==$scope.from.date()&&0==$scope.from.month()&&31==$scope.to.date()&&11==$scope.to.month()&&$scope.from.year()==$scope.to.year())$scope.title=$scope.from.format("YYYY"),$scope.previousFrom=new moment($scope.from).subtract(1,"year"),$scope.previousTo=new moment($scope.to).subtract(1,"year"),$scope.nextFrom=new moment($scope.from).add(1,"year"),$scope.nextTo=new moment($scope.to).add(1,"year");else if(1==$scope.from.date()&&new moment($scope.from).endOf("month").date()==$scope.to.date()&&$scope.from.month()==$scope.to.month()&&$scope.from.year()==$scope.to.year())$scope.title=$scope.from.format("MMMM YYYY"),$scope.previousFrom=new moment($scope.from).subtract(1,"month").startOf("month"),$scope.previousTo=new moment($scope.from).subtract(1,"month").endOf("month"),$scope.nextFrom=new moment($scope.from).add(1,"month").startOf("month"),$scope.nextTo=new moment($scope.from).add(1,"month").endOf("month");else{$scope.title=$scope.from.format("YYYY-MM-DD")+" - "+$scope.to.format("YYYY-MM-DD");var days=$scope.to.diff($scope.from,"days")+1;$scope.previousFrom=new moment($scope.from).subtract(days,"days"),$scope.previousTo=new moment($scope.to).subtract(days,"days"),$scope.nextFrom=new moment($scope.from).add(days,"days"),$scope.nextTo=new moment($scope.to).add(days,"days")}$scope.weekStart=(new moment).startOf("isoWeek").format("YYYYMMDD"),$scope.weekEnd=(new moment).endOf("isoWeek").format("YYYYMMDD"),$scope.monthStart=(new moment).startOf("month").format("YYYYMMDD"),$scope.monthEnd=(new moment).endOf("month").format("YYYYMMDD"),$scope.yearStart=(new moment).startOf("year").format("YYYYMMDD"),$scope.yearEnd=(new moment).endOf("year").format("YYYYMMDD"),$scope.previous=function(){$state.go("app.time_report",{from:$scope.previousFrom.format("YYYYMMDD"),to:$scope.previousTo.format("YYYYMMDD")},{location:"replace"})},$scope.next=function(){$state.go("app.time_report",{from:$scope.nextFrom.format("YYYYMMDD"),to:$scope.nextTo.format("YYYYMMDD")},{location:"replace"})},$scope.refresh=function(){$scope.loading=!0,TimeRegistration.getinfo({from:$scope.from.format("YYYYMMDD"),to:$scope.to.format("YYYYMMDD")}).$promise.then(function(b){$scope.summary=b.summary;var grouped=_.groupBy(b.perTask,function(i){return JSON.stringify({c:i.companyId,p:i.projectId})});$scope.infoPerProject=_.map(grouped,function(g){return{companyId:g[0].companyId,company:g[0].company,projectId:g[0].projectId,project:g[0].project,tasks:g}})})["finally"](function(){$scope.billableUnbillableGraph=[{label:"Billable",data:$scope.summary.billableMinutes,color:"#7266BA"},{label:"Unbillable",data:$scope.summary.unBillableMinutes,color:"#5D9CEC"}],$scope.hasHours=$scope.summary.unBillableMinutes||$scope.summary.billableMinutes?!0:!1,$scope.loading=!1})}}]),angular.module("time").controller("TimeRegistrationDialogController",["$scope","Project","TimeRegistration","toUpdate","date",function($scope,Project,TimeRegistration,toUpdate,date){"use strict";function showMessage(message){$scope.isBusy=!0,$scope.message=message}function hideMessage(){$scope.isBusy=!1,$scope.message=""}function convertNumericTimeToDisplay(time){var hour=Math.floor(time/100),minutes=Math.floor(time-100*hour);return("00"+hour).slice(-2)+":"+("00"+minutes).slice(-2)}function convertDisplayTimeToNumeric(time){return parseInt(time.replace(":",""),10)}$scope.originalTimeRegistration=toUpdate,$scope.newTimeRegistration=void 0==toUpdate,toUpdate=toUpdate||{},$scope.timeRegistration={company:null,project:null,task:null,billable:toUpdate.billable||!1,description:toUpdate.description||"",from:toUpdate.from?convertNumericTimeToDisplay(toUpdate.from.numeric):"",to:toUpdate.to?convertNumericTimeToDisplay(toUpdate.to.numeric):""},$scope.$watch("timeRegistration.company",function(newv,oldv){oldv&&newv&&oldv.id!=newv.id&&($scope.timeRegistration.project=null,$scope.timeRegistration.task=null)}),$scope.$watch("timeRegistration.project",function(newv,oldv){oldv&&newv&&oldv.id!=newv.id&&($scope.timeRegistration.task=null)}),$scope.$watch("timeRegistration.task",function(){$scope.newTimeRegistration&&$scope.timeRegistration.task&&($scope.timeRegistration.billable=$scope.timeRegistration.task.defaultRateInCents>0)}),$scope.isBusy=!1,$scope.message="",$scope.projects=Project.active(function(){$scope.companies=_.map(_.groupBy($scope.projects,function(p){return p.companyId}),function(g){return{id:g[0].companyId,name:g[0].company.name,projects:g}}),toUpdate.companyId&&($scope.timeRegistration.company=_.first(_.where($scope.companies,{id:toUpdate.companyId}))),toUpdate.projectId&&$scope.timeRegistration.company&&($scope.timeRegistration.project=_.first(_.where($scope.timeRegistration.company.projects,{id:toUpdate.projectId}))),toUpdate.task&&$scope.timeRegistration.project&&($scope.timeRegistration.task=_.first(_.where($scope.timeRegistration.project.tasks,{name:toUpdate.task}))),$scope.$apply()}),$scope.ok=function(){showMessage("Saving time registration...");var id=$scope.newTimeRegistration?{}:{id:$scope.originalTimeRegistration.id};TimeRegistration.save(id,{companyId:$scope.timeRegistration.company.id,projectId:$scope.timeRegistration.project.id,task:$scope.timeRegistration.task.name,description:$scope.timeRegistration.description,billable:$scope.timeRegistration.billable,date:date,from:convertDisplayTimeToNumeric($scope.timeRegistration.from),to:convertDisplayTimeToNumeric($scope.timeRegistration.to)},function(data){hideMessage(),$scope.$close(data)},function(){showMessage("An error occurred...")})},$scope.cancel=function(){$scope.$dismiss("cancel")}}]);